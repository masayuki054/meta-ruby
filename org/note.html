<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>2016 講義ノート・メモ</title>
<!-- 2016-10-11 火 21:11 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="suzuki@cis.iwate-u.ac.jp" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">2016 講義ノート・メモ</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. ruby のノート</a>
<ul>
<li><a href="#sec-1-1">1.1. test-unit</a>
<ul>
<li><a href="#sec-1-1-1">ruby/test</a>
<ul>
<li><a href="#sec-1-1-1-1">test-unit</a></li>
<li><a href="#sec-1-1-1-2">install</a></li>
<li><a href="#sec-1-1-1-3">テストの書き方</a>
<ul>
<li><a href="#sec-1-1-1-3-1">基本</a>
<ul>
<li><a href="#sec-1-1-1-3-1-1">require</a></li>
<li><a href="#sec-1-1-1-3-1-2">テスト・クラス定義</a></li>
<li><a href="#sec-1-1-1-3-1-3">テスト全体の前後処理メソッド:</a></li>
<li><a href="#sec-1-1-1-3-1-4">テストの前後の処理:</a></li>
<li><a href="#sec-1-1-1-3-1-5">テストを test_で始まるメソッドとして定義する:</a></li>
<li><a href="#sec-1-1-1-3-1-6">テスト準備</a></li>
<li><a href="#sec-1-1-1-3-1-7">テスト実行</a></li>
</ul>
</li>
<li><a href="#sec-1-1-1-3-2">アサーション</a></li>
<li><a href="#sec-1-1-1-3-3">便利な機能</a>
<ul>
<li><a href="#sec-1-1-1-3-3-1">sub_test_case</a></li>
<li><a href="#sec-1-1-1-3-3-2">test</a></li>
<li><a href="#sec-1-1-1-3-3-3">setup/teardown ブロック</a></li>
<li><a href="#sec-1-1-1-3-3-4">test_order</a></li>
<li><a href="#sec-1-1-1-3-3-5">データ駆動テスト</a></li>
</ul>
</li>
<li><a href="#sec-1-1-1-3-4">その他</a>
<ul>
<li><a href="#sec-1-1-1-3-4-1">assertの作り方</a></li>
<li><a href="#sec-1-1-1-3-4-2">Rakeのタスク定義</a></li>
</ul>
</li>
<li><a href="#sec-1-1-1-3-5">まとめ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. 情報元</a></li>
<li><a href="#sec-1-3">1.3. Ruby紹介</a>
<ul>
<li><a href="#sec-1-3-1">Ruby</a>
<ul>
<li><a href="#sec-1-3-1-1">はじめに</a>
<ul>
<li><a href="#sec-1-3-1-1-1">Rubyの特長</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-4">1.4. Rubyの原理</a>
<ul>
<li><a href="#sec-1-4-1">Rubyの原理</a>
<ul>
<li><a href="#sec-1-4-1-1">Todo オブジェクト</a>
<ul>
<li><a href="#sec-1-4-1-1-1">オブジェクトとは</a></li>
<li><a href="#sec-1-4-1-1-2">クラス</a>
<ul>
<li><a href="#sec-1-4-1-1-2-1">モジュール</a></li>
</ul>
</li>
<li><a href="#sec-1-4-1-1-3">メソッド</a></li>
</ul>
</li>
<li><a href="#sec-1-4-1-2">Todo クラス</a>
<ul>
<li><a href="#sec-1-4-1-2-1">クラスとオブジェクト</a></li>
<li><a href="#sec-1-4-1-2-2">モジュール</a></li>
<li><a href="#sec-1-4-1-2-3">特異クラス</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-5">1.5. 言語上のこと</a>
<ul>
<li><a href="#sec-1-5-1">変数 変数 - Ruby入門</a>
<ul>
<li><a href="#sec-1-5-1-1">変数への代入</a></li>
<li><a href="#sec-1-5-1-2">変数の種類</a></li>
<li><a href="#sec-1-5-1-3">Ruby予約語</a></li>
<li><a href="#sec-1-5-1-4">自己代入</a></li>
<li><a href="#sec-1-5-1-5">多重代入</a></li>
</ul>
</li>
<li><a href="#sec-1-5-2">スコープ</a>
<ul>
<li><a href="#sec-1-5-2-1">メソッド - Ruby入門</a>
<ul>
<li><a href="#sec-1-5-2-1-1">Rubyにおけるトップレベル</a>
<ul>
<li><a href="#sec-1-5-2-1-1-1">トップレベル</a></li>
<li><a href="#sec-1-5-2-1-1-2">selfとmain</a></li>
<li><a href="#sec-1-5-2-1-1-3">トップレベルに定義されたメソッド</a></li>
</ul>
</li>
<li><a href="#sec-1-5-2-1-2">メソッドの定義と呼び出し</a></li>
<li><a href="#sec-1-5-2-1-3">メソッドの呼び出し</a>
<ul>
<li><a href="#sec-1-5-2-1-3-1">メソッド定義の位置</a></li>
</ul>
</li>
<li><a href="#sec-1-5-2-1-4">引数を付けたメソッド呼び出し</a></li>
<li><a href="#sec-1-5-2-1-5">引数のデフォルト値</a></li>
<li><a href="#sec-1-5-2-1-6">引数を配列として受け取る</a></li>
<li><a href="#sec-1-5-2-1-7">メソッドの戻り値</a></li>
<li><a href="#sec-1-5-2-1-8">多重代入を使って複数の戻り値を取得</a>
<ul>
<li><a href="#sec-1-5-2-1-8-1">クラスとは</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-6">1.6. クラスライブラリ</a>
<ul>
<li><a href="#sec-1-6-1">Rubyリファレンス</a></li>
<li><a href="#sec-1-6-2">BasicObject</a>
<ul>
<li><a href="#sec-1-6-2-1">メソッド一覧</a>
<ul>
<li><a href="#sec-1-6-2-1-1">クラスメソッド</a></li>
<li><a href="#sec-1-6-2-1-2">インスタンスメソッド</a></li>
<li><a href="#sec-1-6-2-1-3">特別な役割のメソッド</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-6-3">Object</a>
<ul>
<li><a href="#sec-1-6-3-1">親クラスとモジュール</a></li>
<li><a href="#sec-1-6-3-2">メソッド一覧</a>
<ul>
<li><a href="#sec-1-6-3-2-1">クラスメソッド</a></li>
<li><a href="#sec-1-6-3-2-2">インスタンスメソッド</a></li>
<li><a href="#sec-1-6-3-2-3">privateメソッド</a></li>
<li><a href="#sec-1-6-3-2-4">Rubyから呼び出されるメソッド</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-6-4">Module</a>
<ul>
<li><a href="#sec-1-6-4-1">親クラスとモジュール</a></li>
<li><a href="#sec-1-6-4-2">メソッド一覧</a>
<ul>
<li><a href="#sec-1-6-4-2-1">クラスメソッド</a></li>
<li><a href="#sec-1-6-4-2-2">publicなインスタンスメソッド</a></li>
<li><a href="#sec-1-6-4-2-3">privateなインスタンスメソッド</a></li>
<li><a href="#sec-1-6-4-2-4">Rubyから呼び出されるメソッド</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-6-5">Class</a>
<ul>
<li><a href="#sec-1-6-5-1">親クラスとモジュール</a></li>
<li><a href="#sec-1-6-5-2">メソッド一覧</a>
<ul>
<li><a href="#sec-1-6-5-2-1">クラスメソッド</a></li>
<li><a href="#sec-1-6-5-2-2">インスタンスメソッド</a></li>
<li><a href="#sec-1-6-5-2-3">Rubyから呼び出されるメソッド</a>
<ul>
<li><a href="#sec-1-6-5-2-3-1">文字列 - Ruby入門</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-7">1.7. クラス・モジュールの概念</a>
<ul>
<li><a href="#sec-1-7-1">クラス・モジュールの概念 Ruby</a>
<ul>
<li><a href="#sec-1-7-1-1">関連  オブジェクト指向スクリプト言語 Ruby</a></li>
<li><a href="#sec-1-7-1-2">例 Panda モジュール</a>
<ul>
<li><a href="#sec-1-7-1-2-1">定数 Module</a></li>
</ul>
</li>
<li><a href="#sec-1-7-1-3">例 Zooクラス</a></li>
<li><a href="#sec-1-7-1-4">例： UenoZoo を Zoo を継承して作る</a></li>
<li><a href="#sec-1-7-1-5">説明</a>
<ul>
<li><a href="#sec-1-7-1-5-1">mix-in</a></li>
<li><a href="#sec-1-7-1-5-2">継承</a></li>
<li><a href="#sec-1-7-1-5-3">継承とMix-in</a></li>
<li><a href="#sec-1-7-1-5-4">extend</a></li>
</ul>
</li>
<li><a href="#sec-1-7-1-6">モジュールの使い方</a>
<ul>
<li><a href="#sec-1-7-1-6-1">名前空間としての使い方</a></li>
</ul>
</li>
<li><a href="#sec-1-7-1-7">まとめ</a></li>
<li><a href="#sec-1-7-1-8">モジュールの先祖</a></li>
</ul>
</li>
<li><a href="#sec-1-7-2">meta</a>
<ul>
<li><a href="#sec-1-7-2-1">クラス</a></li>
<li><a href="#sec-1-7-2-2">モジュール</a></li>
<li><a href="#sec-1-7-2-3">Class と Module</a></li>
<li><a href="#sec-1-7-2-4">クラス - モジュール</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-8">1.8. メタプログラミング</a>
<ul>
<li>
<ul>
<li><a href="#sec-1-8-0-1">2016.01.25 オブジェクトモデル</a>
<ul>
<li><a href="#sec-1-8-0-1-1">class定義</a></li>
<li><a href="#sec-1-8-0-1-2">object のクラス階層</a></li>
<li><a href="#sec-1-8-0-1-3">クラスのクラス階層</a></li>
<li><a href="#sec-1-8-0-1-4">メタクラスのクラス階層</a></li>
<li><a href="#sec-1-8-0-1-5">特異クラスと特異メソッド</a>
<ul>
<li><a href="#sec-1-8-0-1-5-1">特異メソッド</a></li>
<li><a href="#sec-1-8-0-1-5-2"><code>m</code> は何処にあるか？</a></li>
</ul>
</li>
<li><a href="#sec-1-8-0-1-6">test class hier</a></li>
</ul>
</li>
<li><a href="#sec-1-8-0-2">2016.02.01 method</a>
<ul>
<li><a href="#sec-1-8-0-2-1">method_missing</a></li>
<li><a href="#sec-1-8-0-2-2">動的methodの仕組み</a></li>
<li><a href="#sec-1-8-0-2-3">method_missing(method, *args)の利用</a></li>
<li><a href="#sec-1-8-0-2-4">最終形</a></li>
</ul>
</li>
<li><a href="#sec-1-8-0-3">2016.02.09 ブロック</a>
<ul>
<li><a href="#sec-1-8-0-3-1">ブロックの基本</a>
<ul>
<li><a href="#sec-1-8-0-3-1-1">ブロックの作成</a></li>
<li><a href="#sec-1-8-0-3-1-2">ブロックが与えられているか？</a></li>
<li><a href="#sec-1-8-0-3-1-3">ブロックの呼び出し</a></li>
</ul>
</li>
<li><a href="#sec-1-8-0-3-2">クロージャ</a>
<ul>
<li><a href="#sec-1-8-0-3-2-1">コードの実行</a></li>
<li><a href="#sec-1-8-0-3-2-2">スコープのまとめ</a></li>
</ul>
</li>
<li><a href="#sec-1-8-0-3-3">instance_eval()</a>
<ul>
<li><a href="#sec-1-8-0-3-3-1">カプセル化の破壊</a></li>
</ul>
</li>
<li><a href="#sec-1-8-0-3-4">呼び出し可能オブジェクト</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-8-1">memo コード</a>
<ul>
<li><a href="#sec-1-8-1-1">class 階層</a></li>
<li><a href="#sec-1-8-1-2">self</a></li>
<li><a href="#sec-1-8-1-3">methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-9">1.9. sqlite3</a></li>
<li><a href="#sec-1-10">1.10. sqlite3-ruby</a>
<ul>
<li><a href="#sec-1-10-1">関連サイト</a></li>
<li><a href="#sec-1-10-2">gem</a></li>
<li><a href="#sec-1-10-3">sqlite</a></li>
<li><a href="#sec-1-10-4">setup</a></li>
<li><a href="#sec-1-10-5">ruby</a></li>
<li><a href="#sec-1-10-6">firefox sqlite database handling</a></li>
<li><a href="#sec-1-10-7">firefox sqlite database handling 2</a></li>
<li><a href="#sec-1-10-8"></a></li>
</ul>
</li>
<li><a href="#sec-1-11">1.11. sinatra-org</a></li>
<li><a href="#sec-1-12">1.12. references</a></li>
<li><a href="#sec-1-13">1.13. what</a></li>
<li><a href="#sec-1-14">1.14. how</a></li>
<li><a href="#sec-1-15">1.15. directory</a></li>
<li><a href="#sec-1-16">1.16. sinatraのための設定</a>
<ul>
<li><a href="#sec-1-16-1">bundler</a></li>
<li><a href="#sec-1-16-2">gemfile</a></li>
<li><a href="#sec-1-16-3">config.ru</a></li>
</ul>
</li>
<li><a href="#sec-1-17">1.17. service</a>
<ul>
<li><a href="#sec-1-17-1">application</a></li>
<li><a href="#sec-1-17-2">起動</a>
<ul>
<li><a href="#sec-1-17-2-1">確認</a></li>
<li><a href="#sec-1-17-2-2">起動用 org 文書 (org/run.org)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">2. memo</a>
<ul>
<li><a href="#sec-2-1">2.1. memo</a>
<ul>
<li><a href="#sec-2-1-1">Doing test-unit</a></li>
<li><a href="#sec-2-1-2">Doing poker.org</a></li>
<li><a href="#sec-2-1-3">global</a></li>
<li><a href="#sec-2-1-4">ソースコード解説</a></li>
<li><a href="#sec-2-1-5">ソースコード pry-doc</a></li>
<li><a href="#sec-2-1-6">EmacsでPATHの設定が引き継がれない問題をエレガントに解決する - Qiita</a></li>
<li><a href="#sec-2-1-7">gem install spreadsheet for meta-ruby</a></li>
<li><a href="#sec-2-1-8">meta-ruby 講義内容</a></li>
<li><a href="#sec-2-1-9">Done .ob org-mode #+babel_include の導入&#xa0;&#xa0;&#xa0;<span class="tag"><span class="include">include</span>&#xa0;<span class="babel">babel</span>&#xa0;<span class="org">org</span></span></a>
<ul>
<li><a href="#sec-2-1-9-1">why</a></li>
<li><a href="#sec-2-1-9-2">how</a></li>
<li><a href="#sec-2-1-9-3">script</a></li>
<li><a href="#sec-2-1-9-4">working directory</a></li>
</ul>
</li>
<li><a href="#sec-2-1-10">Doing org-tangle&#xa0;&#xa0;&#xa0;<span class="tag"><span class="auto">auto</span>&#xa0;<span class="tangle">tangle</span>&#xa0;<span class="babel">babel</span>&#xa0;<span class="org">org</span></span></a>
<ul>
<li><a href="#sec-2-1-10-1">tangle を make できるように</a>
<ul>
<li><a href="#sec-2-1-10-1-1">ruby gem org-converge 中の org-tangle</a></li>
<li><a href="#sec-2-1-10-1-2">シェルコマンド化</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-1-11">new org-mode babel-include を展開する</a></li>
<li><a href="#sec-2-1-12">ruby 日本語</a></li>
<li><a href="#sec-2-1-13">ruby入門のサイトを変更したい</a></li>
<li><a href="#sec-2-1-14">org babelを調べる</a></li>
<li><a href="#sec-2-1-15">meta-ruby</a></li>
<li><a href="#sec-2-1-16">Rubyを勉強する上で有用な情報源まとめてみた - Qiita</a></li>
<li><a href="#sec-2-1-17">ob-ruby</a></li>
<li><a href="#sec-2-1-18">若手エンジニア／初心者のためのRuby 2.1入門（12）：難しいが強力！ Rubyのメタプログラミング、self、特異クラス／メソッド、オープンクラスとモンキーパッチ (1/4) - ＠IT</a></li>
<li><a href="#sec-2-1-19">Ruby - 【mkdirからデプロイまで3分】Sinatra+Haml+Sass+Coffee でサクッとHerokuに公開して捨てるwebアプリ - Qiita</a></li>
<li><a href="#sec-2-1-20">emacs-24.5 for @cis.iwate-u.ac.jp</a></li>
<li><a href="#sec-2-1-21">~/bin/org2html index.org</a></li>
<li><a href="#sec-2-1-22">Todo ditaa@github install後，ditaa.jar が見つからない</a></li>
<li><a href="#sec-2-1-23">log new_file  graphviz</a></li>
<li><a href="#sec-2-1-24">Emacs org-modeを使ってみる: (19) graphvizとditaaの図を埋め込む - 屯遁のパズルとプログラミングの日記</a></li>
<li><a href="#sec-2-1-25">memo lstree&#xa0;&#xa0;&#xa0;<span class="tag"><span class="directory">directory</span></span></a></li>
<li><a href="#sec-2-1-26">org2HTMLの自動化</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<a href="./">ホーム</a> /
<a href="./lects.html">講義</a> /
<a href="./ruby.html">ruby</a> / 
<a href="./oo.html">OO</a> / 
<a href="./emacs.html">emacs</a> / 
<a href="./meta-ruby.html">meta-ruby</a> /
<a href="./note.html">note</a> /
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/">2015</a>
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> ruby のノート</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> test-unit</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1">ruby/test</h4>
<div class="outline-text-4" id="text-1-1-1">
</div><div id="outline-container-sec-1-1-1-1" class="outline-5">
<h5 id="sec-1-1-1-1">test-unit</h5>
<div class="outline-text-5" id="text-1-1-1-1">
<p>
新らしい単体テスト・フレームワークを使いましょう:
</p>
<ul class="org-ul">
<li><a href="http://qiita.com/repeatedly/items/727b08599d87af7fa671">Ruby - Test::Unitでテストを書く - Qiita</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-1-1-2" class="outline-5">
<h5 id="sec-1-1-1-2">install</h5>
<div class="outline-text-5" id="text-1-1-1-2">
<div class="org-src-container">

<pre class="src src-sh">gem install test-unit
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3" class="outline-5">
<h5 id="sec-1-1-1-3">テストの書き方</h5>
<div class="outline-text-5" id="text-1-1-1-3">
</div><div id="outline-container-sec-1-1-1-3-1" class="outline-6">
<h6 id="sec-1-1-1-3-1">基本</h6>
<div class="outline-text-6" id="text-1-1-1-3-1">
<ul class="org-ul">
<li>classで書く．
</li>
<li>TestCase毎に呼ばれる startup/shutdown 
</li>
<li>Test毎に呼ばれる setup/teardown/cleanup
</li>
<li>テストは test で始まるメソッドで書く
</li>
</ul>
</div>

<div id="outline-container-sec-1-1-1-3-1-1" class="outline-7">
<h7 id="sec-1-1-1-3-1-1">require</h7>
<div class="outline-text-7" id="text-1-1-1-3-1-1">
<div class="org-src-container">

<pre class="src src-ruby">require "rubygems"
gem "test-unit"
require 'test/unit'
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-1-2" class="outline-7">
<h7 id="sec-1-1-1-3-1-2">テスト・クラス定義</h7>
<div class="outline-text-7" id="text-1-1-1-3-1-2">
<div class="org-src-container">

<pre class="src src-ruby">class TestSample &lt; Test::Unit::TestCase
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-1-3" class="outline-7">
<h7 id="sec-1-1-1-3-1-3">テスト全体の前後処理メソッド:</h7>
<div class="outline-text-7" id="text-1-1-1-3-1-3">
<pre class="example">
class &lt;&lt; self
  # テスト群の実行前に呼ばれる．変な初期化トリックがいらなくなる
  def startup
    p :_startup
  end

  # テスト群の実行後に呼ばれる
  def shutdown
    p :_shutdown
  end
end
</pre>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-1-4" class="outline-7">
<h7 id="sec-1-1-1-3-1-4">テストの前後の処理:</h7>
<div class="outline-text-7" id="text-1-1-1-3-1-4">
<div class="org-src-container">

<pre class="src src-ruby"># 毎回テスト実行前に呼ばれる
def setup
  p :setup
end

# テストがpassedになっている場合に，テスト実行後に呼ばれる．テスト後の状態確認とかに使える
def cleanup
  p :cleanup
end

# 毎回テスト実行後に呼ばれる
def teardown
  p :treadown
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-1-5" class="outline-7">
<h7 id="sec-1-1-1-3-1-5">テストを test_で始まるメソッドとして定義する:</h7>
<div class="outline-text-7" id="text-1-1-1-3-1-5">
<div class="org-src-container">

<pre class="src src-ruby">  def test_foo
    p 'test_foo'
    assert_true(1 == 1)
  end

  def test_bar
    p 'test_bar'
    assert_equal(1, 1)
  end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-1-6" class="outline-7">
<h7 id="sec-1-1-1-3-1-6">テスト準備</h7>
<div class="outline-text-7" id="text-1-1-1-3-1-6">
<p>
(defvar org-babel-ruby-command "<i>users/home/masayuki</i>.rbenv/shims/ruby"
"Name of command to use for executing ruby code.")
</p>

<div class="org-src-container">

<pre class="src src-ruby">p require "rubygems"
p gem "test-unit"
p RUBY_VERSION
'end'
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-1-7" class="outline-7">
<h7 id="sec-1-1-1-3-1-7">テスト実行</h7>
<div class="outline-text-7" id="text-1-1-1-3-1-7">
<p>
デフォルトだとアルファベット順にテストが実行される．
</p>

<div class="org-src-container">

<pre class="src src-sh">which ruby
gem install test-unit
ruby test_sample.rb
echo 'end'
</pre>
</div>

<pre class="example">
/usr/bin/ruby
Run options: 

# Running tests:

:setup
"test_bar"
:treadown
.:setup
"test_foo"
:treadown
E

Finished tests in 0.003415s, 585.6515 tests/s, 292.8258 assertions/s.

  1) Error:
test_foo(TestSample):
NoMethodError: undefined method `assert_true' for #&lt;TestSample:0x007fb08a8164c8&gt;
    test_sample.rb:36:in `test_foo'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:1301:in `run'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit/testcase.rb:17:in `run'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:919:in `block in _run_suite'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:912:in `map'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:912:in `_run_suite'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit.rb:657:in `block in _run_suites'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit.rb:655:in `each'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit.rb:655:in `_run_suites'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:867:in `_run_anything'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:1060:in `run_tests'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:1047:in `block in _run'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:1046:in `each'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:1046:in `_run'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/minitest/unit.rb:1035:in `run'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit.rb:21:in `run'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit.rb:774:in `run'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit.rb:366:in `block (2 levels) in autorun'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit.rb:27:in `run_once'
    /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/test/unit.rb:365:in `block in autorun'

2 tests, 1 assertions, 0 failures, 1 errors, 0 skips

ruby -v: ruby 2.0.0p481 (2014-05-08 revision 45883) [universal.x86_64-darwin14]
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-2" class="outline-6">
<h6 id="sec-1-1-1-3-2">アサーション</h6>
<div class="outline-text-6" id="text-1-1-1-3-2">
<p>
<a href="https://test-unit.github.io/test-unit/ja/Test/Unit/Assertions.html">https://test-unit.github.io/test-unit/ja/Test/Unit/Assertions.html</a>
</p>

<p>
のページの"Instance Method Summary"にあるassertで始まるメソッド群
が該当．各メソッドに飛べば実際のコード例が出てくるので，参照しつつ
適宜使い分ける．
</p>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-3" class="outline-6">
<h6 id="sec-1-1-1-3-3">便利な機能</h6>
<div class="outline-text-6" id="text-1-1-1-3-3">
</div><div id="outline-container-sec-1-1-1-3-3-1" class="outline-7">
<h7 id="sec-1-1-1-3-3-1">sub_test_case</h7>
<div class="outline-text-7" id="text-1-1-1-3-3-1">
<p>
RSpecだとdescribeとかでネスト出来るが，それをTest::Unitで出来る．実際
はTest::Unitでも継承すれば出来るけど，こっちの方が簡潔で好き.
</p>

<p>
class TestSample &lt; Test::Unit::TestCase
  sub_test_case "Foo context" do
</p>
<p>
end
</p>

<p>
sub_test_case "Bar context" do
</p>
<p>
  end
end
</p>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-3-2" class="outline-7">
<h7 id="sec-1-1-1-3-3-2">test</h7>
<div class="outline-text-7" id="text-1-1-1-3-3-2">
<p>
メソッド名ベースだと使えない文字とかもあり，少し表現がしにくかっ
た．けど，testを使えば解決！
</p>

<div class="org-src-container">

<pre class="src src-ruby">class TestSample &lt; Test::Unit::TestCase
  test "We can write good information" do
    # assert_nil(nil)
  end
end
</pre>
</div>

<p>
Test::Unitのgemにはdescriptionという機能があって，それとメソッド
定義のシンタックスシュガーらしい．以下のコードは上とほぼ同じ．
</p>

<p>
class TestSample &lt; Test::Unit::TestCase
  description "We can write good information"
  def test_foo_bar
</p>
<p>
  end
end
</p>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-3-3" class="outline-7">
<h7 id="sec-1-1-1-3-3-3">setup/teardown ブロック</h7>
<div class="outline-text-7" id="text-1-1-1-3-3-3">
<p>
sub_test_caseを使っていると，RSpecのbeforeのように各ケース毎に追
加でセットアップ処理を書きたくなる．TestCaseにはsetupメソッドがあ
るけど，これはオーバーライドしてしまうので使えない．このような場
合にはsetupブロックを使う．setupメソッドとは違い，beforeのように
何個でも書ける．
</p>

<p>
class TestSample &lt; Test::Unit::TestCase
  setup do
    puts "parent"
  end
</p>

<p>
sub_test_case "Sub!" do
  setup do
    puts "sub1"
  end
</p>

<p>
setup do
  puts "sub2"
end
</p>

<p>
    def test_sub
      assert_true(true)
    end
  end
end
</p>

<p>
上の例を走らせると以下のようになる．もちろん，teardownも同様に出来る．
</p>

<p>
Loaded suite test_nest
Started
parent
sub1
sub2
.
</p>

<p>
Finished in 0.000896 seconds.
</p>

<p>
注意点として，setupメソッドとsetupブロックでは優先順位が決まっている．気になるなら，setupブロックで統一した方が良いかもしれない．
</p>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-3-4" class="outline-7">
<h7 id="sec-1-1-1-3-3-4">test_order</h7>
<div class="outline-text-7" id="text-1-1-1-3-3-4">
<p>
テストの実行順序を指定出来る．どうしても定義順に実行したいのであれば，:definedを指定すれば上から順に実行される．
</p>

<p>
class TestSample &lt; Test::Unit::TestCase
  self.test_order = :defined
end
</p>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-3-5" class="outline-7">
<h7 id="sec-1-1-1-3-3-5">データ駆動テスト</h7>
<div class="outline-text-7" id="text-1-1-1-3-3-5">
<p>
テストとデータを分けて書ける機能です．成功するテストや失敗するテ
ストをまとめたりするのに便利．テストの中でeach回すのはイケてない
し，かといってコピペで重複したテスト書くのもつらい．この機能使え
ば，ちゃんとデータセット毎にテストがわかれます．
</p>

<div class="org-src-container">

<pre class="src src-ruby">class TestSample &lt; Test::Unit::TestCase
  # 'test1'がラベルで，[1, 1]がtest_equalの引数に渡される
  data(
    'test1' =&gt; [1, 1],
    'test2' =&gt; [2, 2])
  def test_equal(data)
    expected, actual = data
    assert_equal(expected, actual)
  end

  data(
    'test1' =&gt; [1, 2],
    'test2' =&gt; [2, 3])
  def test_not_equal(data)
    expected, actual = data
    assert_not_equal(expected, actual)
  end
end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-4" class="outline-6">
<h6 id="sec-1-1-1-3-4">その他</h6>
<div class="outline-text-6" id="text-1-1-1-3-4">
</div><div id="outline-container-sec-1-1-1-3-4-1" class="outline-7">
<h7 id="sec-1-1-1-3-4-1">assertの作り方</h7>
<div class="outline-text-7" id="text-1-1-1-3-4-1">
<p>
Test::Unit::Assertions以下に定義して，そのファイルをrequireで読み
込むだけ．assert_blockとかbuild_messageとかのヘルパーが利用可能．
assert_blockの中に条件を書く．
</p>

<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit/assertions'

module Test::Unit::Assertions
  def assert_oreore(expected, actual)
    assert_block("failure message") do
      expected == (actual + 'oreore')
    end
  end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-4-2" class="outline-7">
<h7 id="sec-1-1-1-3-4-2">Rakeのタスク定義</h7>
<div class="outline-text-7" id="text-1-1-1-3-4-2">
<p>
コピペで使い回す
</p>

<div class="org-src-container">

<pre class="src src-ruby">desc 'Run test_unit based test'
Rake::TestTask.new do |t|
  # To run test for only one file (or file path pattern)
  #  $ bundle exec rake test TEST=test/test_specified_path.rb
  t.libs &lt;&lt; "test"
  t.test_files = Dir["test/**/test_*.rb"]
  t.verbose = true
end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-1-3-5" class="outline-6">
<h6 id="sec-1-1-1-3-5">まとめ</h6>
<div class="outline-text-6" id="text-1-1-1-3-5">
<p>
RSpecほど機能がリッチじゃないので，足りないなら自分で書く必要があ
るけど，Fluentdレベルだとそんなに困ってない． 個人的には，
Parameterized Testが入ってくれれば嬉しいという所かな．
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> 情報元</h3>
<div class="outline-text-3" id="text-1-2">
<p>
オブジェクト指向スクリプト言語 Ruby リファレンスマニュアル (Ruby 2.0.0)
<a href="http://docs.ruby-lang.org/ja/2.0.0/doc/index.html">http://docs.ruby-lang.org/ja/2.0.0/doc/index.html</a>
</p>

<p>
Ruby入門
<a href="http://www.rubylife.jp/ini/">http://www.rubylife.jp/ini/</a>
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Ruby紹介</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<a href="http://www.rubylife.jp/ini/">ruby入門</a> <a href="ruby-note.html">ruby note</a> <a href="http://docs.ruby-lang.org/ja/2.0.0/doc/index.html">リファレンスマニュアル</a> 
</p>
</div>

<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1">Ruby</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
<a href="http://docs.ruby-lang.org/ja/2.0.0/doc/index.html">Ruby リファレンスマニュアル (Ruby 2.0.0)</a> より
</p>
</div>

<div id="outline-container-sec-1-3-1-1" class="outline-5">
<h5 id="sec-1-3-1-1">はじめに</h5>
<div class="outline-text-5" id="text-1-3-1-1">
<ul class="org-ul">
<li>Rubyは手軽なオブジェクト指向プログラミングのためのインタプリタ言語
</li>
<li>Rubyはテキスト処理やシステム管理のための豊富な機能を持っています。 
</li>
<li>Rubyは単純で、分かりやすく、簡単に拡張できます。
</li>
</ul>
</div>

<div id="outline-container-sec-1-3-1-1-1" class="outline-6">
<h6 id="sec-1-3-1-1-1">Rubyの特長</h6>
<div class="outline-text-6" id="text-1-3-1-1-1">
<ul class="org-ul">
<li>インタプリタ

<p>
Rubyはインタプリタ言語です。プログラムを実行するためにコンパイル
する必要はありません。
</p>
</li>

<li>変数に型が無い (動的型付け)

<p>
Rubyの変数はどのような型のデータも格納する事ができますので、 変
数の型について心配する必要はありません。 半面、コンパイル時のチェッ
クは弱くなります。
</p>
</li>

<li>変数宣言が不要

<p>
Rubyでは変数を宣言無しで使う事ができます。 変数の種類(ローカル変
数、グローバル変数、インスタンス変数など)は 変数名から知る事がで
きます。
</p>
</li>

<li>単純な文法

<p>
Rubyの文法はEiffelからわずかに影響を受けた単純なものです。
</p>
</li>

<li>ユーザによるメモリ管理が不要

<p>
Rubyはメモリ管理を自動的に行います。 どこからもアクセスされなく
なったオブジェクトは インタプリタに組み込みのガーベージコレクタ
によって回収されます。
</p>
</li>

<li>全てがオブジェクト

<p>
Rubyははじめから純粋なオブジェクト指向言語として設計されています。
整数のような基本的なデータ型をはじめとして、 全てのデータをオブ
ジェクトとして統一的に取り扱えます。
</p>
</li>

<li>クラス、継承、メソッド

<p>
Rubyは クラス、継承、メソッドのようなオブジェクト指向言語として
基本的な機能は 当然持っています。
</p>
</li>

<li>特異メソッド

<p>
ある特定のオブジェクトにメソッドを付加することができます。 たと
えば、GUIのあるボタンを押された時の動作を メソッドとして記述する
ような使い方ができますし、 これを応用してプロトタイプベースの オ
ブジェクト指向プログラミングも可能です(やりたければね)。
</p>
</li>

<li>モジュールによるMix-in

<p>
Rubyは多重継承は複雑さの源であるという見地から、 意図的に多重継
承を持っていませんが、 モジュールを使ってクラス階層を横断して実
装を共有できます。 この機能を"Mix-in"と呼びます。
</p>
</li>

<li>ブロック付きメソッド呼び出し(イテレータ)

<p>
制御構造の抽象化を援助するブロック付きメソッド呼び出しという機能があります。
</p>
</li>

<li>クロージャ

<p>
手続きをオブジェクトとして扱う機能があります。 このオブジェクト
化された手続きのことをクロージャと呼びます。
</p>
</li>

<li>強力な文字列操作/正規表現

<p>
Perlをお手本とした強力な文字列操作や正規表現検索の機能があります。
</p>
</li>

<li>多倍長整数

<p>
組み込みの多倍長整数機能がありますので、 メモリが許す限り、非常
に大きな整数の演算もできます。 たとえば、400の階乗なども簡単に計
算できます。
</p>
</li>

<li>例外処理機能

<p>
例外処理機能は例外的な状況への対処が簡単に書けます。
</p>
</li>

<li>OSへの直接アクセス

<p>
Rubyは(UNIXの)ほとんどのシステムコールの呼び出し機能を持っていま
す。 Rubyだけでシステムプログラミングも可能です。
</p>
</li>

<li>ダイナミックローディング

<p>
OSが許せば、オブジェクトファイルを実行時に読み込む機能が提供され
ます。
</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Rubyの原理</h3>
<div class="outline-text-3" id="text-1-4">
</div><div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1">Rubyの原理</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li>原典: <a href="http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fobject.html">オブジェクト</a>  (ruby-lang.org)
</li>
<li>原典:  <a href="http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fclass.html">クラス (Ruby 2.0.0)</a>
</li>
</ul>
</div>

<div id="outline-container-sec-1-4-1-1" class="outline-5">
<h5 id="sec-1-4-1-1">Todo オブジェクト</h5>
<div class="outline-text-5" id="text-1-4-1-1">
<p>
ここに，ruby の基本原理， が書かれていると，<i>s-:</i>は思う。
</p>
</div>

<div id="outline-container-sec-1-4-1-1-1" class="outline-6">
<h6 id="sec-1-4-1-1-1">オブジェクトとは</h6>
<div class="outline-text-6" id="text-1-4-1-1-1">
<ul class="org-ul">
<li>Ruby で扱える全ての値はオブジェクトです。 
</li>
<li>Rubyのオブジェクトに対して可能な操作はメソッド呼び出しのみです。
</li>
<li>あるオブジェクトが反応できるメソッドは、
そのオブジェクトが所属するクラスによって一意に決定します。
</li>
<li>所属するクラスはオブジェクト生成時に決まり、その後は特異クラスの導入
以外、所属クラスが変わることはありません。
</li>
<li>またオブジェクトは、特定のクラスに対比して、その「インスタンス」とも呼ばれます。
</li>
<li>オブジェクトの生成は、一般には、別のオブジェクトのメソッドを呼び出すことによって行われます。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-4-1-1-2" class="outline-6">
<h6 id="sec-1-4-1-1-2">クラス</h6>
<div class="outline-text-6" id="text-1-4-1-1-2">
<ul class="org-ul">
<li>クラスは自身に所属するオブジェクトが反応できるメソッドを決定します。
</li>
<li>所属するオブジェクトに対してあるメソッドを呼び出すことができるなら、
そのメソッドが「クラスに定義されている」と言います。
</li>
<li>またメソッドはクラスとメソッド名によって一意に決定します。
</li>

<li>クラスは必ずただひとつの「スーパークラス」を持ち、
</li>
<li>スーパークラスであるメソッドが定義されていれば自クラスでもそのメソッ
ドが同じ内容で定義されていることになります。
これを「継承」と呼びます。
</li>

<li>継承は推移するので、スーパークラスのスーパークラスが持つメソッドもま
た自クラスにおいて定義されていることになります。
</li>
</ul>
</div>

<div id="outline-container-sec-1-4-1-1-2-1" class="outline-7">
<h7 id="sec-1-4-1-1-2-1">モジュール</h7>
<div class="outline-text-7" id="text-1-4-1-1-2-1">
<ul class="org-ul">
<li>ちょっと特殊でクラスではない。しかし機能は同じ。
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-1-1-3" class="outline-6">
<h6 id="sec-1-4-1-1-3">メソッド</h6>
<div class="outline-text-6" id="text-1-4-1-1-3">
<ul class="org-ul">
<li>メソッドは実行することができます。その実行を開始することを通常「呼び
出す」と言います。
</li>
<li>また呼び出すときにはオブジェクトを渡すことができ、そのオブジェクトを
「引数」と呼びます。
</li>
<li>いくつの引数を受け取ることができるかはメソッドの定義時に決定し、変更
することはできません。
</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-sec-1-4-1-2" class="outline-5">
<h5 id="sec-1-4-1-2">Todo クラス</h5>
<div class="outline-text-5" id="text-1-4-1-2">
</div><div id="outline-container-sec-1-4-1-2-1" class="outline-6">
<h6 id="sec-1-4-1-2-1">クラスとオブジェクト</h6>
<div class="outline-text-6" id="text-1-4-1-2-1">
<ul class="org-ul">
<li>Ruby プログラムからはクラスもまたオブジェクトとして扱うことができる。
</li>

<li>以下の基本操作が可能:
<ul class="org-ul">
<li>メソッドの存在を問い合わせる
</li>
<li>メソッドを定義する
</li>
<li>メソッドの定義を取り消す
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-4-1-2-2" class="outline-6">
<h6 id="sec-1-4-1-2-2">モジュール</h6>
<div class="outline-text-6" id="text-1-4-1-2-2">
<ul class="org-ul">
<li>Ruby プログラムからはクラスもまたオブジェクトとして扱うことができる。
</li>

<li>以下の基本操作が可能:
<ul class="org-ul">
<li>メソッドの存在を問い合わせる
</li>
<li>メソッドを定義する
</li>
<li>メソッドの定義を取り消す
</li>
</ul>
</li>
</ul>

<p>
クラスと同じだが，インスタンスを作ること，はできない。
</p>
</div>
</div>


<div id="outline-container-sec-1-4-1-2-3" class="outline-6">
<h6 id="sec-1-4-1-2-3">特異クラス</h6>
<div class="outline-text-6" id="text-1-4-1-2-3">
<p>
あるオブジェクトだけに定義されたクラス (by <i>s-:</i>)
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> 言語上のこと</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li><a href="http://www.rubylife.jp/ini/">ruby入門</a> <a href="ruby-note.html">ruby note</a> <a href="http://docs.ruby-lang.org/ja/2.0.0/doc/index.html">リファレンスマニュアル</a> 

<p>
<a href="http://docs.ruby-lang.org/ja/2.0.0/doc/s">変数と定数 (Ruby 2.0.0)</a>
</p>
</li>
</ul>
</div>


<div id="outline-container-sec-1-5-1" class="outline-4">
<h4 id="sec-1-5-1">変数 <a href="http://www.rubylife.jp/ini/var/">http://www.rubylife.jp/ini/var/</a>          変数 - Ruby入門</h4>
<div class="outline-text-4" id="text-1-5-1">
</div><div id="outline-container-sec-1-5-1-1" class="outline-5">
<h5 id="sec-1-5-1-1">変数への代入</h5>
<div class="outline-text-5" id="text-1-5-1-1">
<p>
変数への代入
</p>
<pre class="example">
変数 = 値
</pre>

<p>
多重代入
： 変数1, 変数2, 変数3 = 値1, 値2, 値3
</p>

<div class="org-src-container">

<pre class="src src-ruby">x1 = 10

x1, x2, x3 = 1, 2, 3

x1, x2, x3 = [1, 2, 3]

'end'
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-1-2" class="outline-5">
<h5 id="sec-1-5-1-2">変数の種類</h5>
<div class="outline-text-5" id="text-1-5-1-2">
<p>
<a href="http://docs.ruby-lang.org/ja/2.0.0/doc/s">http://docs.ruby-lang.org/ja/2.0.0/doc/s</a> 変数と定数 (Ruby 2.0.0)
</p>

<ul class="org-ul">
<li>グローバル変数 
</li>
<li>ローカル変数
</li>

<li>インスタンス変数
</li>
<li>クラス変数
</li>
<li>定数
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-5-1-3" class="outline-5">
<h5 id="sec-1-5-1-3">Ruby予約語</h5>
<div class="outline-text-5" id="text-1-5-1-3">
<p>
： BEGIN    class    ensure   nil      self     when
： END      def      false    not      super    while
： alias    defined? for      or       then     yield
： and      do       if       redo     true
： begin    else     in       rescue   undef
： break    elsif    module   retry    unless
： case     end      next     return   until
</p>

<p>
変数名としては使用できません。 
</p>
</div>
</div>

<div id="outline-container-sec-1-5-1-4" class="outline-5">
<h5 id="sec-1-5-1-4">自己代入</h5>
</div>
<div id="outline-container-sec-1-5-1-5" class="outline-5">
<h5 id="sec-1-5-1-5">多重代入</h5>
</div>
</div>

<div id="outline-container-sec-1-5-2" class="outline-4">
<h4 id="sec-1-5-2">スコープ</h4>
<div class="outline-text-4" id="text-1-5-2">
<p>
講義後半で説明します。
</p>

<p>
Block/Module
</p>
<ul class="org-ul">
<li>ローカル変数
</li>
<li>グローバル変数 
</li>
</ul>

<p>
Object
</p>
<ul class="org-ul">
<li>インスタンス変数
</li>
</ul>

<p>
Class
</p>
<ul class="org-ul">
<li>クラス変数
</li>
</ul>

<p>
Module/Class (?) - ((<b>自信なし</b>))
</p>
<ul class="org-ul">
<li>定数
</li>
<li><a href="http://www.rubylife.jp/ini/">ruby入門</a> <a href="ruby-note.html">ruby note</a> <a href="http://docs.ruby-lang.org/ja/2.0.0/doc/index.html">リファレンスマニュアル</a> 
</li>
</ul>

<p>
<a href="http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fcall.html">http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fcall.html</a>
</p>

<p>
<a href="http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fdef.html">http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fdef.html</a>
</p>
</div>

<div id="outline-container-sec-1-5-2-1" class="outline-5">
<h5 id="sec-1-5-2-1"><a href="http://www.rubylife.jp/ini/method/">メソッド - Ruby入門</a></h5>
<div class="outline-text-5" id="text-1-5-2-1">
</div><div id="outline-container-sec-1-5-2-1-1" class="outline-6">
<h6 id="sec-1-5-2-1-1">Rubyにおけるトップレベル</h6>
<div class="outline-text-6" id="text-1-5-2-1-1">
<p>
<a href="http://www.rubylife.jp/ini/method/index1.html">http://www.rubylife.jp/ini/method/index1.html</a>
</p>
</div>
<div id="outline-container-sec-1-5-2-1-1-1" class="outline-7">
<h7 id="sec-1-5-2-1-1-1">トップレベル</h7>
<div class="outline-text-7" id="text-1-5-2-1-1-1">
<div class="org-src-container">

<pre class="src src-ruby">print("Hello¥n")
'end'
</pre>
</div>


<p>
クラス定義の外側の部分はトップレベルと呼ばれています。
</p>

<p>
ruby が実行されると, トップレベルに記述されたプログラムが順に実行
されて行きます。
</p>
</div>
</div>

<div id="outline-container-sec-1-5-2-1-1-2" class="outline-7">
<h7 id="sec-1-5-2-1-1-2">selfとmain</h7>
<div class="outline-text-7" id="text-1-5-2-1-1-2">
<div class="org-src-container">

<pre class="src src-ruby">self
'end'
</pre>
</div>

<p>
では「main」と言うオブジェクトの元になっているクラスは何かを確認し
てみます。オブジェクトに対して「class」メソッドを実行するとそのオ
ブジェクトをのクラスを返します。
</p>

<div class="org-src-container">

<pre class="src src-ruby">self
self.class
'end'
</pre>
</div>

<p>
「main」オブジェクトの元になっているクラスは「Object」クラスと表示
されます。
</p>
</div>
</div>

<div id="outline-container-sec-1-5-2-1-1-3" class="outline-7">
<h7 id="sec-1-5-2-1-1-3">トップレベルに定義されたメソッド</h7>
<div class="outline-text-7" id="text-1-5-2-1-1-3">
<p>
ップレベルの中にもメソッドを定義することが出来ます。
</p>

<p>
トップレベルに定義されたメソッドは*「Kernel」モジュール*の中に追加
されることになっています。
</p>

<p>
「Kernel」モジュールは全てのクラスの元になっている「Object」クラス
に読み込まれています。
</p>

<p>
その為、トップレベルに定義されたモジュールは、「Kernel」モジュール
の中で既に定義されている「print」メソッドなどと同じようにどのクラス
内からでも呼び出すことができます。
</p>

<p>
またメソッドを呼び出す際に、呼び出し元のオブジェクト(レシーバーと呼
ばれています)を省略できるので、あたかも関数のように使用することが可
能です。
</p>

<p>
よって特定のクラス内ではなくトップレベルの位置にメソッドを定義すれ
ば、関数のように使用できるメソッドを定義することが可能となります。
</p>
</div>
</div>
</div>


<div id="outline-container-sec-1-5-2-1-2" class="outline-6">
<h6 id="sec-1-5-2-1-2">メソッドの定義と呼び出し</h6>
<div class="outline-text-6" id="text-1-5-2-1-2">
<pre class="example">
def メソッド名(引数1, 引数2, ...)
 実行する処理
 実行する処理
end
</pre>

<div class="org-src-container">

<pre class="src src-ruby">public
(def printHello
  print("Hello\n")
end).class

printHello
self.printHello

'end'
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-5-2-1-3" class="outline-6">
<h6 id="sec-1-5-2-1-3">メソッドの呼び出し</h6>
<div class="outline-text-6" id="text-1-5-2-1-3">
<p>
定義されたメソッドを呼び出すと、処理がメソッド内に移りメソッド内に
記述された処理が実行されます。そしてメソッドの最後まで処理が終わる
と、メソッドを呼び出した次の行へ処理が戻ります。
</p>

<p>
メソッドを呼び出す時の書式は次の通りです。 
</p>


<pre class="example">
オブジェクト.メソッド名(引数1, 引数2, ...)
</pre>

<p>
メソッドはクラス内で定義され、そのクラスから作成されるオブジェクト
(レシーバーと呼ばれます)に対して行わせたい処理を記述するものです。
その為、メソッドを呼び出す時には対象となるオブジェクトと実行させる
メソッド名を指定して呼び出します。
</p>


<pre class="example">
メソッド名(引数1, 引数2, ...)
</pre>

<p>
では定義されたメソッドを呼び出してみます。 
</p>
</div>


<div id="outline-container-sec-1-5-2-1-3-1" class="outline-7">
<h7 id="sec-1-5-2-1-3-1">メソッド定義の位置</h7>
<div class="outline-text-7" id="text-1-5-2-1-3-1">
<p>
メソッドは実際に呼び出されるよりも前に定義されていなければなりませ
ん。例えば次のようなプログラムはエラーとなります。
</p>

<p>
上記のようにメソッド呼び出しがメソッドの定義よりも前に実行されると
「undefined local variable or method」と言うエラーが表示されます。
</p>

<div class="org-src-container">

<pre class="src src-ruby">x
'end'
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-5-2-1-4" class="outline-6">
<h6 id="sec-1-5-2-1-4">引数を付けたメソッド呼び出し</h6>
</div>
<div id="outline-container-sec-1-5-2-1-5" class="outline-6">
<h6 id="sec-1-5-2-1-5">引数のデフォルト値</h6>
<div class="outline-text-6" id="text-1-5-2-1-5">
<p>
通常引数は呼び出し側とメソッド定義側で数が一致している必要がありますが、メソッ
ド定義側では引数にデフォルト値を設定することが可能です。書式は次の通りです。 
</p>


<pre class="example">
def メソッド名(変数1=デフォルト値1, 変数2=デフォルト値2, ...)
  実行する処理
  実行する処理
end
</pre>

<div class="org-src-container">

<pre class="src src-ruby">def printHello(msg="No msg", name="No name")
  print(msg + "," + name + "¥n")
end

printHello("Hello", "Yamada")
printHello("Hello")
printHello()

def printHello(msg, name="No name")
  print(msg + "," + name + "¥n")
end

printHello("Hello", "Yamada")
printHello("Hello")

'end'
</pre>
</div>
</div>
</div>



<div id="outline-container-sec-1-5-2-1-6" class="outline-6">
<h6 id="sec-1-5-2-1-6">引数を配列として受け取る</h6>
</div>
<div id="outline-container-sec-1-5-2-1-7" class="outline-6">
<h6 id="sec-1-5-2-1-7">メソッドの戻り値</h6>
</div>
<div id="outline-container-sec-1-5-2-1-8" class="outline-6">
<h6 id="sec-1-5-2-1-8">多重代入を使って複数の戻り値を取得</h6>
<div class="outline-text-6" id="text-1-5-2-1-8">
</div><div id="outline-container-sec-1-5-2-1-8-1" class="outline-7">
<h7 id="sec-1-5-2-1-8-1">クラスとは</h7>
<div class="outline-text-7" id="text-1-5-2-1-8-1">
</div><ul class="org-ul"><li><a id="sec-1-5-2-1-8-1-1" name="sec-1-5-2-1-8-1-1"></a>クラスとオブジェクト<br  /><div class="outline-text-8" id="text-1-5-2-1-8-1-1">
<ul class="org-ul">
<li><b>クラス*は *オブジェクト</b> の設計図です。
</li>

<li>オブジェクトはクラスから生まれる
<ul class="org-ul">
<li>具体化 (instantiate)
</li>
<li>オブジェクトはクラスの <b>インスタンス</b> (instance)
</li>
</ul>
</li>

<li>オブジェクトの処理を記述するのが*メソッド*
<ul class="org-ul">
<li>クラス定義の中に記述する.
</li>
</ul>
</li>

<li>オブジェクト <b>毎</b> の状態を保持するのが <b>インスタンス変数</b>
</li>

<li>(instance) メソッドの実行
</li>
<li>自分の状態 (instance)
</li>
</ul>
</div>
</li>


<li><a id="sec-1-5-2-1-8-1-2" name="sec-1-5-2-1-8-1-2"></a>class Car &#x2026; end<br  /><div class="outline-text-8" id="text-1-5-2-1-8-1-2">
<p>
class は Carクラスから生まれるオブジェクトの振舞を記述する。
</p>

<div class="org-src-container">

<pre class="src src-ruby">class Car
  def initialize(carname)
    @name = carname
  end

  def dispName
    print(@name)
  end
end

car = Car.new("crown")
car.dispName
'end'
</pre>
</div>


<ul class="org-ul">
<li>「車」の設計図であるクラスを定義し、

<p>
： class Car &#x2026; end
</p>
</li>

<li>クラスからオブジェクトを作成した後で、

<pre class="example">
car = Car.new
</pre>
</li>

<li>オブジェクトに対して名前を画面に出力させる

<pre class="example">
car.dispName
</pre>
</li>
</ul>
</div>
</li>

<li><a id="sec-1-5-2-1-8-1-3" name="sec-1-5-2-1-8-1-3"></a>インスタンスメソッド<br  /><div class="outline-text-8" id="text-1-5-2-1-8-1-3">
<p>
クラス内に記述されたメソッドはクラスから作成されたオブジェクトしか
呼び出すことが出来ません。このようなメソッドを <b>インスタンスメソッ
ド</b> と呼びます。
</p>

<div class="org-src-container">

<pre class="src src-ruby">class クラス名

  def メソッド名(引数1, 引数2, ...)
    処理
  end

end
'end'
</pre>
</div>

<p>
例えばクラス名について表示するだけの簡単なインスタンスメソッドは次のようになり
ます。 
</p>

<div class="org-src-container">

<pre class="src src-ruby">class Car
  def dispString(str)
    print(str, "¥n")
  end
end
'end'
</pre>
</div>

<p>
なお、引数が無いメソッドの場合は括弧を省略しても構いません。 
</p>

<div class="org-src-container">

<pre class="src src-ruby">class Car
  def dispClassname
    print("Car class¥n")
  end

  def dispString(str, "¥n")
    print(str)
  end
end
'end'
</pre>
</div>

<p>
インスタンスメソッドの呼び出し
</p>

<p>
定義されたインスタンスメソッドはクラスのオブジェクトから呼び出すことができます。
</p>


<p>
class Car
  def dispClassname
    print("Car class¥n")
  end
</p>

<p>
  def dispString(str, "¥n")
    print(str)
  end
end
</p>

<p>
car = Car.new
car.dispClassname
car.dispString("crown")
</p>

<p>
オブジェクトからメソッドを呼び出すにはオブジェクトの後にドット「.」を付けてメ
ソッドを名を記述します。引数がある場合は括弧の後に引数をカンマで列挙して記述し
て下さい。引数が無い場合はメソッド名だけで結構です。 
</p>


<p>
オブジェクト名.メソッド名(引数1, 引数2, &#x2026;)
オブジェクト名.メソッド名
</p>

<p>
またドット「.」の代わりにコロン(:)を2つ続けて次のように記述することも出来ます。
</p>


<p>
オブジェクト名::メソッド名(引数1, 引数2, &#x2026;)
オブジェクト名::メソッド名
</p>

<p>
どちらの形式も違いはありませんので、どちらかに統一して利用すればいいと思います。
</p>

<p>
オブジェクトを作成する為に使用した「new」メソッドはクラスに対して実行しました。
例えば「Car.new()」のようにです。このようなメソッドはクラスに対して実行するク
ラスメソッドと呼ばされます。今回のようにクラス内に定義したインスタンスメソッド
はクラスから作成したオブジェクトに対して実行する点が異なっていることに注意して
下さい。 
</p>

<p>
サンプルプログラム
</p>

<p>
では実際に試してみます。 
</p>

<p>
ClassTest3.rb 
</p>


<p>
class Car
  def dispClassname
    print("Car class¥n")
  end
</p>

<p>
  def dispString(str)
    print(str, "¥n")
  end
end
</p>

<p>
car = Car.new()
car.dispClassname
car.dispString("crown")
</p>

<p>
上記を実行すると次のように表示されます。 
</p>

<p>
インスタンスメソッド 
</p>

<p>
今回は2つのインスタンスメソッドを定義し、クラスから作成したオブジェクトに対し
てメソッドを実行してみました。 
</p>



<div class="org-src-container">

<pre class="src src-ruby">class Reji
  SHOUHIZEI = 0.05

  def initialize(init=0)
    @sum = init
  end

  def kounyuu(kingaku)
    @sum += kingaku
  end

  def goukei()
    return @sum * (1 + SHOUHIZEI)
  end
end
'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">reji = Reji.new(0)
reji.kounyuu(100)
reji.kounyuu(80)
print(reji.goukei())

'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">SHOUHIZEI
class \Reji
print SHOUHIZEI
end
Reji::SHOUHIZEI
'end'
</pre>
</div>
</div>
</li>


<li><a id="sec-1-5-2-1-8-1-4" name="sec-1-5-2-1-8-1-4"></a>継承<br  /><div class="outline-text-8" id="text-1-5-2-1-8-1-4">
<div class="org-src-container">

<pre class="src src-ruby">class Car
  def accele
    print("アクセルを踏みました")
  end

  def brake
    print("ブレーキを踏みました")
  end
end
'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">a = Car.new("abc")
a.brake
'end'
</pre>
</div>


<div class="org-src-container">

<pre class="src src-ruby">class Soarer &lt; Car
  def initialize(name,type)
     @type = type
     super(name)
  end
  def openroof
    print("open roof\n");
  end
end

class Crown &lt; Car
  def reclining
    print("reclining")
  end
end

'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">so = Soarer.new("soarer")
cr = Crown.new("crwon")

so.class
(so.class).superclass

so.dispName
'end'
</pre>
</div>
<p>
\
</p>
<pre class="example">
#&lt;Soarer:0x007fb02b61d888 @name="soarer"&gt;
#&lt;Crown:0x007fb02b616ec0 @name="crwon"&gt;
Soarer
Car
soarernil
</pre>
</div>
</li></ul>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> クラスライブラリ</h3>
<div class="outline-text-3" id="text-1-6">
</div><div id="outline-container-sec-1-6-1" class="outline-4">
<h4 id="sec-1-6-1">Rubyリファレンス</h4>
<div class="outline-text-4" id="text-1-6-1">
<p>
原典
</p>
<ul class="org-ul">
<li><a href="http://ref.xaio.jp/ruby/">http://ref.xaio.jp/ruby/</a>
</li>
<li><a href="http://ref.xaio.jp/ruby/classes">http://ref.xaio.jp/ruby/classes</a>
</li>
</ul>

<p>
method名やkeywordからクラスを探せるようにこの org文書を作成しました。
</p>
</div>
</div>

<div id="outline-container-sec-1-6-2" class="outline-4">
<h4 id="sec-1-6-2">BasicObject</h4>
<div class="outline-text-4" id="text-1-6-2">
<p>
<a href="http://ref.xaio.jp/ruby/classes/basic_object">http://ref.xaio.jp/ruby/classes/basic_object</a>
</p>

<p>
*=BasicObject=*クラスは、Ruby 1.9で新しく用意されたクラスで、=Object=
クラスの親クラスです。通常は、=BasicObject=オブジェクトを直接使うこと
はありません。
</p>

<p>
=BasicObject=は=Object=や=Kernel=のメソッドを持たないので、「メソッド
がほぼゼロの白紙のクラスを作りたい」というときは、=BasicObject=を継承
したサブクラスで実現できます。
</p>
</div>

<div id="outline-container-sec-1-6-2-1" class="outline-5">
<h5 id="sec-1-6-2-1">メソッド一覧</h5>
<div class="outline-text-5" id="text-1-6-2-1">
</div><div id="outline-container-sec-1-6-2-1-1" class="outline-6">
<h6 id="sec-1-6-2-1-1">クラスメソッド</h6>
<div class="outline-text-6" id="text-1-6-2-1-1">
<ul class="org-ul">
<li><code>new</code> : インスタンスの作成。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-2-1-2" class="outline-6">
<h6 id="sec-1-6-2-1-2">インスタンスメソッド</h6>
<div class="outline-text-6" id="text-1-6-2-1-2">
<ul class="org-ul">
<li><code>!</code> : 否定。
</li>
<li><code>!=</code> : 別のものか調べる。
</li>
<li><code>==</code> : オブジェクトの内容が同じか調べる。
</li>
<li><code>__send__</code> : メソッドを呼び出す。
</li>
<li><code>equal?</code> : 同じオブジェクトか調べる。
</li>
<li><code>instance_eval</code> : インスタンスの元でコードを実行。
</li>
<li><code>instance_exec</code> : インスタンスの元でコードを実行。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-2-1-3" class="outline-6">
<h6 id="sec-1-6-2-1-3">特別な役割のメソッド</h6>
<div class="outline-text-6" id="text-1-6-2-1-3">
<ul class="org-ul">
<li><code>initialize</code> : オブジェクトを作成（=new=）するとき呼ばれる。
</li>
<li><code>initialize_copy</code> :
オブジェクトをコピー（=clone=、=dup=）するとき呼ばれる。
</li>
<li><code>method_missing</code> : メソッドが見つからないとき呼ばれる。
</li>
<li><code>singleton_method_added</code> : 特異メソッドを定義するとき呼ばれる。
</li>
<li><code>singleton_method_removed</code> : 特異メソッドを削除するとき呼ばれる。
</li>
<li><code>singleton_method_undefined</code> :
特異メソッドを未定義にするとき呼ばれる。
</li>
</ul>

<p>
<a href="file:///ruby/about">このサイトについて</a> <a href="file:///ruby/legend">記事の読み方</a>
<a href="file:///ruby/references">参考文献</a>
</p>

<p>
Sponsored by <a href="http://www.oiax.jp/">Oiax Inc.</a> / Powered by Ruby on
Rails and AmiWiki
</p>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-1-6-3" class="outline-4">
<h4 id="sec-1-6-3">Object</h4>
<div class="outline-text-4" id="text-1-6-3">
<ul class="org-ul">
<li><a href="http://ref.xaio.jp/ruby/classes/object">http://ref.xaio.jp/ruby/classes/object</a>
</li>
</ul>

<p>
*=Object=*クラスは、すべてのクラスの親クラスです。
</p>
</div>

<div id="outline-container-sec-1-6-3-1" class="outline-5">
<h5 id="sec-1-6-3-1">親クラスとモジュール</h5>
<div class="outline-text-5" id="text-1-6-3-1">
<p>
=Object=クラスは=Kernel=モジュールをインクルードしています。
</p>

<p>
=BasicObject=クラスが=Object=クラスの親クラスになりました。
</p>

<pre class="example">
Object &lt; Kernel (&lt; BasicObject)
</pre>
</div>
</div>

<div id="outline-container-sec-1-6-3-2" class="outline-5">
<h5 id="sec-1-6-3-2">メソッド一覧</h5>
<div class="outline-text-5" id="text-1-6-3-2">
</div><div id="outline-container-sec-1-6-3-2-1" class="outline-6">
<h6 id="sec-1-6-3-2-1">クラスメソッド</h6>
<div class="outline-text-6" id="text-1-6-3-2-1">
<ul class="org-ul">
<li><code>new</code> : インスタンスの作成。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-3-2-2" class="outline-6">
<h6 id="sec-1-6-3-2-2">インスタンスメソッド</h6>
<div class="outline-text-6" id="text-1-6-3-2-2">
<p>
これらのメソッドは、実際には=Kernel=モジュールの=public=なメソッドとして実装されていますが、一般的に=Object=クラスのメソッドとして扱われます。また、この一覧には=BasicObject=のメソッドも混ぜてあります。
</p>

<ul class="org-ul">
<li><code>!</code> : 否定。Ruby 1.9
</li>
<li><code>!=</code> : 別のものか調べる。Ruby 1.9
</li>
<li><code>!~</code> : パターンマッチの否定。Ruby 1.9
</li>
<li><code>==</code> : オブジェクトの内容が同じか調べる。
</li>
<li><code>===</code> : =case=式でオブジェクトをテストする。
</li>
<li><code>=~</code> : パターンマッチ。
</li>
<li><code>__id__</code> : オブジェクトIDを返す。
</li>
<li><code>__send__</code> : メソッドを呼び出す。
</li>
<li><code>class</code> : オブジェクトのクラスを返す。
</li>
<li><code>clone</code> : オブジェクトのコピーを作成する。
</li>
<li><code>define_singleton_method</code> : 特異メソッドを定義する。Ruby 1.9
</li>
<li><code>display</code> : オブジェクトを文字列として出力する。
</li>
<li><code>dup</code> : オブジェクトのコピーを作成する。
</li>
<li><code>eql?</code> : ハッシュのキーとして同じか調べる。
</li>
<li><code>equal?</code> : 同じオブジェクトか調べる。
</li>
<li><code>enum_for</code> : =Enumerator=オブジェクトの作成。Ruby 1.8.7
</li>
<li><code>extend</code> : モジュールのメソッドを取り込む。
</li>
<li><code>freeze</code> : オブジェクトを凍結する。
</li>
<li><code>frozen?</code> : オブジェクトの凍結状態を調べる。
</li>
<li><code>hash</code> : ハッシュ値を返す。
</li>
<li><code>id</code> : オブジェクトIDを返す。+Ruby 1.9+
</li>
<li><code>inspect</code> : 読みやすい文字列に変換。
</li>
<li><code>instance_eval</code> : インスタンスの元でコードを実行。
</li>
<li><code>instance_exec</code> : インスタンスの元でコードを実行。Ruby 1.8.7
</li>
<li><code>instance_of?</code> : クラスに属しているか調べる。
</li>
<li><code>instance_variable_defined?</code> : インスタンス変数があるか調べる。
</li>
<li><code>instance_variable_get</code> : インスタンス変数の値を得る。
</li>
<li><code>instance_variable_set</code> : インスタンス変数の値を変える。
</li>
<li><code>instance_variables</code> : インスタンス変数の名前を配列で返す。
</li>
<li><code>is_a?</code> : クラスに属しているか調べる。
</li>
<li><code>kind_of?</code> : クラスに属しているか調べる。
</li>
<li><code>method</code> : メソッドから=Method=オブジェクトを作成。
</li>
<li><code>methods</code> : メソッドの名前を配列で返す。
</li>
<li><code>nil?</code> : =nil=かどうか調べる。
</li>
<li><code>object_id</code> : オブジェクトIDを返す。
</li>
<li><code>private_methods</code> : =private=なメソッドの名前を配列で返す。
</li>
<li><code>protected_methods</code> : =protected=なメソッドの名前を配列で返す。
</li>
<li><code>public_method</code> :
=public=なメソッドから=Method=オブジェクトを作成。Ruby 1.9
</li>
<li><code>public_methods</code> : =public=なメソッドの名前を配列で返す。
</li>
<li><code>public_send</code> : =public=なメソッドを呼び出す。Ruby 1.9
</li>
<li><code>respond_to?</code> : メソッドを呼び出せるか調べる。
</li>
<li><code>send</code> : メソッドを呼び出す。
</li>
<li><code>singleton_class</code> : 特異クラスを返す。Ruby 1.9.2
</li>
<li><code>singleton_methods</code> : 特異メソッドの名前を配列で返す。
</li>
<li><code>taint</code> : オブジェクトを汚染する。
</li>
<li><code>tainted?</code> : 汚染状態を調べる。
</li>
<li><code>tap</code> : ブロックに自身を渡し、自身を返す。Ruby 1.8.7
</li>
<li><code>to_a</code> : 配列に変換。+Ruby 1.9+
</li>
<li><code>to_enum</code> : =Enumerator=オブジェクトの作成。Ruby 1.8.7
</li>
<li><code>to_s</code> : 文字列に変換。
</li>
<li><code>trust</code> : 信頼される状態に戻す。Ruby 1.9
</li>
<li><code>type</code> : オブジェクトのクラスを返す。+Ruby 1.9+
</li>
<li><code>untaint</code> : オブジェクトの汚染を除く。
</li>
<li><code>untrust</code> : オブジェクトを信頼されない状態にする。Ruby 1.9
</li>
<li><code>untrusted?</code> : 信頼状態を調べる。Ruby 1.9
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-3-2-3" class="outline-6">
<h6 id="sec-1-6-3-2-3">privateメソッド</h6>
<div class="outline-text-6" id="text-1-6-3-2-3">
<ul class="org-ul">
<li><code>remove_instance_variable</code> : インスタンス変数の削除。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-3-2-4" class="outline-6">
<h6 id="sec-1-6-3-2-4">Rubyから呼び出されるメソッド</h6>
<div class="outline-text-6" id="text-1-6-3-2-4">
<ul class="org-ul">
<li><code>initialize</code> : オブジェクトを作成（=new=）するとき呼ばれる。
</li>
<li><code>initialize_copy</code> :
オブジェクトをコピー（=clone=、=dup=）するとき呼ばれる。
</li>
<li><code>method_missing</code> : メソッドが見つからないとき呼ばれる。
</li>
<li><code>respond_to_missing?</code> : =respond_to?=が=false=のとき呼ばれる。Ruby
1.9.2
</li>
<li><code>singleton_method_added</code> : 特異メソッドを定義するとき呼ばれる。
</li>
<li><code>singleton_method_removed</code> : 特異メソッドを削除するとき呼ばれる。
</li>
<li><code>singleton_method_undefined</code> :
特異メソッドを未定義にするとき呼ばれる。
</li>
</ul>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-1-6-4" class="outline-4">
<h4 id="sec-1-6-4">Module</h4>
<div class="outline-text-4" id="text-1-6-4">
<p>
=Module=クラスは、クラスとモジュールを表すクラスです。=Class=クラスは
=Module=のサブクラスで、クラスだけを表します。
</p>

<p>
クラス・モジュールを定義すると、クラス名・モジュール名は
=Class=/=Module=オブジェクトを指す変数（定数）になります。
=Class=/=Module=オブジェクトをレシーバにすれば、=Class=/=Module=クラス
の=public=メソッドを呼び出せます。
</p>

<p>
クラス・モジュール定義の中のように、=self=が=Class=/=Module=オブジェク
トである場所では、=Class=/=Module=クラスの=private=メソッドを呼び出せ
ます。=attr_accessor=や=include=は=Module=クラスの=private=メソッドで
す。
</p>
</div>

<div id="outline-container-sec-1-6-4-1" class="outline-5">
<h5 id="sec-1-6-4-1">親クラスとモジュール</h5>
<div class="outline-text-5" id="text-1-6-4-1">
<p>
=Module=クラスの親クラスは=Object=クラスです。
</p>

<pre class="example">
Module &lt; Object &lt; Kernel (&lt; BasicObject)
</pre>
</div>
</div>

<div id="outline-container-sec-1-6-4-2" class="outline-5">
<h5 id="sec-1-6-4-2">メソッド一覧</h5>
<div class="outline-text-5" id="text-1-6-4-2">
</div><div id="outline-container-sec-1-6-4-2-1" class="outline-6">
<h6 id="sec-1-6-4-2-1">クラスメソッド</h6>
<div class="outline-text-6" id="text-1-6-4-2-1">
<ul class="org-ul">
<li><code>constants</code> : 現在使える定数名の一覧を返す。
</li>
<li><code>nesting</code> : 現在のクラス・モジュールのネスト状態を調べる。
</li>
<li><code>new</code> : モジュール定義を使わずにモジュールを作成。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-4-2-2" class="outline-6">
<h6 id="sec-1-6-4-2-2">publicなインスタンスメソッド</h6>
<div class="outline-text-6" id="text-1-6-4-2-2">
<ul class="org-ul">
<li><code>&lt;, &lt;</code>, &gt;, &gt;== : 2つのクラスやモジュールの関係を調べる。
</li>
<li><code>&lt;=&gt;</code> : 2つのクラスやモジュールの関係を調べる。
</li>
<li><code>==</code> : 同じものか調べる。
</li>
<li><code>===</code> : クラスに属しているか調べる。
</li>
<li><code>ancestors</code> : 祖先クラスとモジュールの一覧を返す。
</li>
<li><code>autoload</code> : 定数に対応するファイルを自動ロードする。
</li>
<li><code>autoload?</code> : 定数が自動ロードされるか調べる。
</li>
<li><code>class_eval</code> : クラスやモジュールの元でコードを実行。
</li>
<li><code>class_exec</code> : クラスやモジュールの元でコードを実行。Ruby 1.8.7
</li>
<li><code>class_variable_defined?</code> : クラス変数があるか調べる。
</li>
<li><code>class_variables</code> : クラス変数名の一覧を返す。
</li>
<li><code>const_defined?</code> : 定数があるか調べる。
</li>
<li><code>const_get</code> : 定数の値を得る。
</li>
<li><code>const_set</code> : 定数を設定する。
</li>
<li><code>constants</code> : 定数名の一覧を返す。
</li>
<li><code>freeze</code> : クラスやモジュールを凍結する。
</li>
<li><code>include?</code> : モジュールをインクルードしているか調べる。
</li>
<li><code>included_modules</code> : インクルードしているモジュールの一覧を返す。
</li>
<li><code>instance_method</code> : メソッドから=UnboundMethod=オブジェクトを作成。
</li>
<li><code>instance_methods</code> : メソッドの名前を配列で返す。
</li>
<li><code>method_defined?</code> : メソッドがあるか調べる。
</li>
<li><code>module_eval</code> : クラスやモジュールの元でコードを実行。
</li>
<li><code>module_exec</code> : クラスやモジュールの元でコードを実行。Ruby 1.8.7
</li>
<li><code>name</code> : クラスやモジュールの名前を返す。
</li>
<li><code>private_class_method</code> : クラスメソッドを=private=にする。
</li>
<li><code>private_instance_methods</code> : =private=メソッドの名前を配列で返す。
</li>
<li><code>private_method_defined?</code> : =private=メソッドがあるか調べる。
</li>
<li><code>protected_instance_methods</code> :
=protected=メソッドの名前を配列で返す。
</li>
<li><code>protected_method_defined?</code> : =protected=メソッドがあるか調べる。
</li>
<li><code>public_class_method</code> : クラスメソッドを=public=にする。
</li>
<li><code>public_instance_method</code> :
=public=メソッドから=UnboundMethod=オブジェクトを作成。Ruby 1.9
</li>
<li><code>public_instance_methods</code> : =public=メソッドの名前を配列で返す。
</li>
<li><code>public_method_defined?</code> : =public=メソッドがあるか調べる。
</li>
<li><code>to_s</code> : クラスやモジュールを表す文字列を返す。
</li>
</ul>

<p>
以下のメソッドは、Ruby 1.8では=private=でしたが、Ruby
1.9では=public=になりました。
</p>

<ul class="org-ul">
<li><code>class_variable_get</code> : クラス変数の値を得る。
</li>
<li><code>class_variable_set</code> : クラス変数を設定する。
</li>
<li><code>remove_class_variable</code> : クラス変数の削除。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-4-2-3" class="outline-6">
<h6 id="sec-1-6-4-2-3">privateなインスタンスメソッド</h6>
<div class="outline-text-6" id="text-1-6-4-2-3">
<ul class="org-ul">
<li><code>alias_method</code> : メソッドに別名を付ける。
</li>
<li><code>attr</code> : インスタンス変数のアクセサを定義する。
</li>
<li><code>attr_accessor</code> : インスタンス変数のアクセサを定義する。
</li>
<li><code>attr_reader</code> : インスタンス変数の読み出し専用アクセサを定義する。
</li>
<li><code>attr_writer</code> : インスタンス変数の書き込み専用アクセサを定義する。
</li>
<li><code>define_method</code> : メソッドを定義する。
</li>
<li><code>include</code> : モジュールをインクルードする。
</li>
<li><code>module_function</code> : モジュールのメソッドをモジュール関数にする。
</li>
<li><code>private</code> : メソッドを=private=にする。
</li>
<li><code>protected</code> : メソッドを=protected=にする。
</li>
<li><code>public</code> : メソッドを=public=にする。
</li>
<li><code>remove_const</code> : 定数の削除。
</li>
<li><code>remove_method</code> : メソッドの削除。
</li>
<li><code>undef_method</code> : メソッドを未定義にする。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-4-2-4" class="outline-6">
<h6 id="sec-1-6-4-2-4">Rubyから呼び出されるメソッド</h6>
<div class="outline-text-6" id="text-1-6-4-2-4">
<ul class="org-ul">
<li><code>append_features</code> : インクルードされる前に呼ばれる。
</li>
<li><code>const_missing</code> : 存在しない定数を参照したときに呼ばれる。
</li>
<li><code>included</code> : インクルードされたあとで呼ばれる。
</li>
<li><code>extended</code> : オブジェクトに取り込まれたあとで呼ばれる。
</li>
<li><code>extend_object</code> : オブジェクトに取り込まれる前に呼ばれる。
</li>
<li><code>method_added</code> : メソッドを定義したときに呼ばれる。
</li>
<li><code>method_removed</code> : メソッドを削除したときに呼ばれる。
</li>
<li><code>method_undefined</code> : メソッドを未定義にしたときに呼ばれる。
</li>
</ul>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-6-5" class="outline-4">
<h4 id="sec-1-6-5">Class</h4>
<div class="outline-text-4" id="text-1-6-5">
<p>
=Class=クラスは、クラスを表すクラスで、=Module=クラスのサブクラスです。
</p>

<p>
クラスに関する機能のほとんどは、=Module=クラスに実装されていますので、=Module=クラスのほうを先に調べるといいでしょう。=Class=クラスの機能は、「=Module=の機能＋インスタンスの作成とクラスの継承」です。
</p>
</div>

<div id="outline-container-sec-1-6-5-1" class="outline-5">
<h5 id="sec-1-6-5-1">親クラスとモジュール</h5>
<div class="outline-text-5" id="text-1-6-5-1">
<p>
=Class=クラスの親クラスは=Module=クラスです。
</p>

<pre class="example">
Class &lt; Module &lt; Object &lt; Kernel (&lt; BasicObject)
</pre>
</div>
</div>

<div id="outline-container-sec-1-6-5-2" class="outline-5">
<h5 id="sec-1-6-5-2">メソッド一覧</h5>
<div class="outline-text-5" id="text-1-6-5-2">
</div><div id="outline-container-sec-1-6-5-2-1" class="outline-6">
<h6 id="sec-1-6-5-2-1">クラスメソッド</h6>
<div class="outline-text-6" id="text-1-6-5-2-1">
<ul class="org-ul">
<li><code>new</code> : クラス定義を使わずにクラスを作成。 

<p>
Class.new で無名クラスを作る
</p>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-6-5-2-2" class="outline-6">
<h6 id="sec-1-6-5-2-2">インスタンスメソッド</h6>
<div class="outline-text-6" id="text-1-6-5-2-2">
<ul class="org-ul">
<li><code>allocate</code> : インスタンスの作成。
</li>
<li><code>new</code> : インスタンスの作成と初期化。
</li>
<li><code>superclass</code> : 親クラスを返す。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-5-2-3" class="outline-6">
<h6 id="sec-1-6-5-2-3">Rubyから呼び出されるメソッド</h6>
<div class="outline-text-6" id="text-1-6-5-2-3">
<ul class="org-ul">
<li><code>inherited</code> : クラスが継承されたときに呼ばれる。
</li>
</ul>

<p>
次のメソッドは=Module=クラスで定義されていますが、=Class=クラスでは未定義にされています：<br  />
 <code>append_features=、=extend_object</code>
</p>

<p>
<a href="file:///ruby/about">このサイトについて</a> <a href="file:///ruby/legend">記事の読み方</a>
<a href="file:///ruby/references">参考文献</a>
</p>

<p>
Sponsored by <a href="http://www.oiax.jp/">Oiax Inc.</a> / Powered by Ruby on
Rails and AmiWiki
</p>

<ul class="org-ul">
<li><a href="http://www.rubylife.jp/ini/">ruby入門</a> <a href="ruby-note.html">ruby note</a> <a href="http://docs.ruby-lang.org/ja/2.0.0/doc/index.html">リファレンスマニュアル</a> <a href="http://docs.ruby-lang.org/ja/2.0.0/class/String.html">class String</a>
</li>
</ul>

<p>
<a href="eww "http://www.rubylife.jp/ini/"">ruby入門</a>
</p>
</div>

<div id="outline-container-sec-1-6-5-2-3-1" class="outline-7">
<h7 id="sec-1-6-5-2-3-1"><a href="http://www.rubylife.jp/ini/string/">文字列 - Ruby入門</a></h7>
<div class="outline-text-7" id="text-1-6-5-2-3-1">
</div><ul class="org-ul"><li><a id="sec-1-6-5-2-3-1-1" name="sec-1-6-5-2-3-1-1"></a>文字列オブジェクト<br  /><div class="outline-text-8" id="text-1-6-5-2-3-1-1">
<div class="org-src-container">

<pre class="src src-ruby">String.new("こんにちは\n")
"こんにちは\n"
"こんにちは\n".class
String.class
'end'
</pre>
</div>
</div>
</li>

<li><a id="sec-1-6-5-2-3-1-2" name="sec-1-6-5-2-3-1-2"></a>バックスラッシュ記法によるエスケープ<br  /></li>
<li><a id="sec-1-6-5-2-3-1-3" name="sec-1-6-5-2-3-1-3"></a>%Q、%qによる文字列の作成<br  /><div class="outline-text-8" id="text-1-6-5-2-3-1-3">
<div class="org-src-container">

<pre class="src src-ruby">require 'kconv'
print Kconv.toutf8(%Q[こんにちは"佐藤"さん\nお元気ですか]), "\n"
print Kconv.toutf8(%q|こんにちは\nお元気ですか|), "\n"
'end
</pre>
</div>
</div>
</li>

<li><a id="sec-1-6-5-2-3-1-4" name="sec-1-6-5-2-3-1-4"></a>ヒアドキュメントによる複数行文字列の作成<br  /><div class="outline-text-8" id="text-1-6-5-2-3-1-4">
</div>
</li>

<li><a id="sec-1-6-5-2-3-1-5" name="sec-1-6-5-2-3-1-5"></a>文字列の中に式を展開<br  /><div class="outline-text-8" id="text-1-6-5-2-3-1-5">
<div class="org-src-container">

<pre class="src src-ruby">name = "東京"
print("出身は #{name*10} です")
'end'
</pre>
</div>

<p>
便利で，よく使います。
</p>
</div>
</li>

<li><a id="sec-1-6-5-2-3-1-6" name="sec-1-6-5-2-3-1-6"></a>文字列 methods<br  /><div class="outline-text-8" id="text-1-6-5-2-3-1-6">
</div>
</li></ul>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> クラス・モジュールの概念</h3>
<div class="outline-text-3" id="text-1-7">
</div><div id="outline-container-sec-1-7-1" class="outline-4">
<h4 id="sec-1-7-1">クラス・モジュールの概念 Ruby</h4>
<div class="outline-text-4" id="text-1-7-1">
<ul class="org-ul">
<li>origin:  <a href="http://qiita.com/ToruFukui/items/2dd4d2d1ce6ed05928de">クラス・モジュールの概念 Ruby - Qiita</a>
</li>
</ul>

<p>
ここでクラスとモジュールの概念について学ぶ。
</p>
</div>

<div id="outline-container-sec-1-7-1-1" class="outline-5">
<h5 id="sec-1-7-1-1">関連  <a href="https://www.ruby-lang.org/ja/">オブジェクト指向スクリプト言語 Ruby</a></h5>
<div class="outline-text-5" id="text-1-7-1-1">
<ul class="org-ul">
<li><a href="http://docs.ruby-lang.org/ja/2.0.0/doc/index.html">オブジェクト指向スクリプト言語 Ruby リファレンスマニュアル (Ruby 2.0.0)</a>
</li>

<li><a href="http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fobject.html">オブジェクト (Ruby 2.0.0)</a>
</li>

<li><a href="http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fclass.html">クラス (Ruby 2.0.0)</a>
</li>

<li><a href="http://docs.ruby-lang.org/ja/2.0.0/class/Module.htm">class Module (Ruby 2.0.0)</a>
</li>

<li><a href="http://docs.ruby-lang.org/ja/2.0.0/doc/spec=2fdef.html">クラス／メソッドの定義 (Ruby 2.0.0)</a>
</li>

<li><a href="http://docs.ruby-lang.org/ja/2.0.0/class/Class.html">class Class (Ruby 2.0.0)</a>
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-1-7-1-2" class="outline-5">
<h5 id="sec-1-7-1-2">例 Panda モジュール</h5>
<div class="outline-text-5" id="text-1-7-1-2">
<div class="org-src-container">

<pre class="src src-ruby">module Panda

  def visit_to_Japan
    "Mr.TonTon"
  end

  def panda
    @panda = "panda"
  end

end
'end'
</pre>
</div>

<p>
Pandの型，Pandが受け継いでいる型は何でしょう？
</p>

<div class="org-src-container">

<pre class="src src-ruby">Panda.class ## Pandaの型
Panda.ancestors ## Panda型の階層
'end'
</pre>
</div>

<p>
Panda は Moduleクラスのオブジェクト， Pand = Module.new
</p>

<p>
module Panda; &#x2026; ;end は，Panda のトップレベルを開いて，
実行すること。
</p>

<div class="org-src-container">

<pre class="src src-ruby">Panda.new
'end'
</pre>
</div>



<p>
Panda.new とかはできない
</p>

<div class="org-src-container">

<pre class="src src-ruby">module Panda
  def panda
    @panda = "panda"
  end
end
'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">Panda.pand
'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">Panda.instance_methods(false)

'end'
</pre>
</div>







<pre class="example">
module Panda; def m ; end 
</pre>

<p>
つまり，Panda にメソッドを定義できる。
</p>

<pre class="example">
module Panda; CONST = 'panda const'; end 
Panda::CONST
CONST
</pre>

<p>
つまり，Panda は名前空間。
</p>
</div>

<div id="outline-container-sec-1-7-1-2-1" class="outline-6">
<h6 id="sec-1-7-1-2-1">定数 Module</h6>
<div class="outline-text-6" id="text-1-7-1-2-1">
<p>
Module の class は Class, つまり Module は Classクラスのオブジェクト，
つまりクラス
</p>

<p>
Module.new で Module型のオブジェクト(モジュール)を作る
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-1-3" class="outline-5">
<h5 id="sec-1-7-1-3">例 Zooクラス</h5>
<div class="outline-text-5" id="text-1-7-1-3">
<div class="org-src-container">

<pre class="src src-ruby">class Zoo
  def the_zoo
    "there are lots of animal"
  end
end
'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">## Zooの型
Zoo.class
(Zoo.class).ancestors

## Zoo型の階層
Zoo.ancestors

## クラス？
Zoo.new
'end'
</pre>
</div>

<p>
Zoo は Classクラスのオブジェクト， Zoo = Class.new
</p>

<p>
class Zoo; &#x2026; ; end は， Zoo のトップレベルを開いて，実行すること
</p>

<p>
Zoo.new ができる。Zoo.class の ancestors に Class が入っているから
</p>
</div>
</div>

<div id="outline-container-sec-1-7-1-4" class="outline-5">
<h5 id="sec-1-7-1-4">例： UenoZoo を Zoo を継承して作る</h5>
<div class="outline-text-5" id="text-1-7-1-4">
<div class="org-src-container">

<pre class="src src-ruby">class UenoZoo &lt; Zoo    # Zooクラスの継承
  include Panda        # Pandaモジュールを mix-in
  def monkey
    @monkey = "monkey"
  end
  def elephant
    @elephant = "elephant"
  end
  def lion
    @lion = "lion"
  end
  def self.name        # UenoZooクラスの特異メソッド
    "Ueno Zoo"
  end
end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">(UenoZoo.class).ancestors
UenoZoo.ancestors
UenoZoo.new
'end'
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-1-5" class="outline-5">
<h5 id="sec-1-7-1-5">説明</h5>
<div class="outline-text-5" id="text-1-7-1-5">
</div><div id="outline-container-sec-1-7-1-5-1" class="outline-6">
<h6 id="sec-1-7-1-5-1">mix-in</h6>
<div class="outline-text-6" id="text-1-7-1-5-1">
<p>
モジュールをクラスに取り込む事をmix-inといい、ソフトクリームの上に
載せるトッピングがその名の由来。
</p>
</div>
</div>

<div id="outline-container-sec-1-7-1-5-2" class="outline-6">
<h6 id="sec-1-7-1-5-2">継承</h6>
<div class="outline-text-6" id="text-1-7-1-5-2">
<p>
Rubyのクラスは継承ができ、親のクラスのインスタンスメソッドを子が受け継ぐ。
１つのクラスに二つ以上のクラスは継承ができなく、これを単純継承という。
</p>
</div>
</div>

<div id="outline-container-sec-1-7-1-5-3" class="outline-6">
<h6 id="sec-1-7-1-5-3">継承とMix-in</h6>
<div class="outline-text-6" id="text-1-7-1-5-3">
<p>
上記のコードはUenoZooクラスはZooクラスのメソッドを継承している。またUenoZooク
ラスはPandaモジュールをmixinしている。
</p>

<p>
Zooクラスで定義されているインスタンスメソッドはUenoZooクラスで使えて、Pandaモ
ジュールをインクルードすることによって、Zooクラスでインスタンスメソッドとして
使う事ができる。
</p>
</div>
</div>

<div id="outline-container-sec-1-7-1-5-4" class="outline-6">
<h6 id="sec-1-7-1-5-4">extend</h6>
<div class="outline-text-6" id="text-1-7-1-5-4">
<p>
モジュールはクラスの使い方にバリエーションを与える。
</p>

<p>
もしModuleをクラスメソッドとして定義したい場合は extend を使用する
事によって使う事ができる。
</p>

<div class="org-src-container">

<pre class="src src-ruby">class UenoZoo
  extend Panda
end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">(UenoZoo.class).ancestors
UenoZoo.ancestors
UenoZoo.singleton_methods
UenoZoo.singleton_class
UenoZoo.new
'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">UenoZoo.visit_to_Japan
UenoZoo.name
UenoZoo.panda
'end'
</pre>
</div>

<p>
また prepend を使えば継承関係を一番手前にしてモジュールにあるメソッドにsuperを
使ってオーバーライド(メソッド上書き)できるようになる、Railsのコントローラーで
使われるbefore actionのような機能を実装できる。
super メソッドは継承されているクラスのメソッド、もしくはモジュールでmixinされ
たメソッドで同名のメソッドを呼ぶ事ができるメソッド。
</p>

<p>
module Panda
</p>

<p>
def visit_to_Japan
  super + " and " + "Mr.TonTon"
end
</p>

<p>
  def panda
    @panda = "panda"
  end
end
</p>

<p>
class UenoZoo &lt; Zoo
  prepend Panda
  def monkey
    @monkey = "monkey"
  end
</p>

<p>
def elephant
  @elephant = "elephant"
end
</p>

<p>
def lion
  @lion = "lion"
end
</p>

<p>
def self.name
  "Ueno Zoo"
end
</p>

<p>
end
</p>

<p>
&gt; UenoZoo.ancestors
</p>

<p>
=&gt; [Panda, UenoZoo, Zoo, Object, Kernel, BasicObject]
</p>

<p>
UenoZoo.new.visit_to_Japan
</p>

<p>
=&gt; "Mr.RanRan and Mr.TonTon"
</p>

<p>
ちなみにクラスにはinitializeメソッドという便利なメソッドが定義されている。
このメソッドはオブジェクトが作成された時に呼ばれるメソッドである。
</p>

<p>
例えば、上のコードでmonkeyメソッドとelephantメソッドとlionメソッドはインスタン
ス変数を定義してメソッドに格納しているが下記のメソッドのようにすれば短くなる。
</p>

<div class="org-src-container">

<pre class="src src-ruby">class UenoZoo

 def initialize(monkey="monkey", elephant="elephant", lion="lion")
   @monkey = monkey
   @elephant = elephant
   @lion = lion
 end

end

UenoZoo.new.instance_variables

=&gt; [:@monkey, :@elephant, :@lion]
</pre>
</div>

<p>
このままだとメソッドで変数を呼び出せないので, attr_readerを使う。
</p>

<div class="org-src-container">

<pre class="src src-ruby">class UenoZoo
 attr_reader :monkey, :elephant, :lion  

 def initialize(monkey="monkey", elephant="elephant", lion="lion")
    @monkey = monkey
    @elephant = elephant
    @lion = lion
 end

end

UenoZoo.new.monkey

=&gt; "monkey"
Ueno.new.monkey = "pokey"
=&gt;  undefined method `monkey=' for #&lt;UenoZoo:0x007fa782157008&gt; (NoMethodError)
</pre>
</div>

<p>
ただこのメソッドは格納したインスタンス変数を呼び出す機能しかないので、
書き込み機能も加えるためにattr_accessorを使う。書き込みのみの場合は
attr_writerを使う。
</p>

<div class="org-src-container">

<pre class="src src-ruby">class UenoZoo
 attr_accessor :monkey, :elephant, :lion  

 def initialize(monkey="monkey", elephant="elephant", lion="lion")
    @monkey = monkey
    @elephant = elephant
    @lion = lion
 end

end

UenoZoo.new.monkey

=&gt; "monkey"
Ueno.new.monkey = "pokey"

=&gt; "pokey"
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-7-1-6" class="outline-5">
<h5 id="sec-1-7-1-6">モジュールの使い方</h5>
<div class="outline-text-5" id="text-1-7-1-6">
<p>
２種類ある
</p>

<ul class="org-ul">
<li>メソッドの格納庫として使う
</li>

<li>名前空間として使う
</li>
</ul>
</div>

<div id="outline-container-sec-1-7-1-6-1" class="outline-6">
<h6 id="sec-1-7-1-6-1">名前空間としての使い方</h6>
<div class="outline-text-6" id="text-1-7-1-6-1">
<p>
同じクラスを定義して、既存のメソッドとは知らずに新たに定義し直して、将来
的なバグに繋がる可能性になる。
</p>

<p>
またクラス名とモジュール名は定数で定義されていて、
module名で定義された定数はclass名で定義できない。
その場合は名前空間として使う。下記のコードを参照してほしい。
</p>

<div class="org-src-container">

<pre class="src src-ruby">class Cat
  def tuna
    "delicious"
  end
end

module Zoo

  class Cat  

    def tuna
      "delicious"
    end
  end

end

&gt; Zoo::Cat.new.tuna
=&gt; "delicious"
&gt; Cat.new.tuna
=&gt; "delicious"
</pre>
</div>

<p>
CatクラスとZoo::Catクラスは別々のオブジェクトになる。module名と
class名は定数だが定数の中から定数を呼ぶ場合はコロンを二個つけて::
で呼び出す。
</p>
</div>
</div>
</div>


<div id="outline-container-sec-1-7-1-7" class="outline-5">
<h5 id="sec-1-7-1-7">まとめ</h5>
<div class="outline-text-5" id="text-1-7-1-7">
<p>
クラスはインスタンス化能力をもちメソッドを定義できる、モジュールは
インスタンス化能力を持たないがメソッドを格納できる。モジュールの利
用法はメソッドを格納するか名前空間として利用する。
</p>

<p>
クラスにモジュールを取り込むことをmixinといってincludeを使う。
</p>

<p>
またクラスメソッドとして取り込む場合はextend、継承関係に着目して取
り込む場合はprepend。attr属性(attr_accessor, attr_writer,
attr_reader)を使えば、そのクラスに属性を与えられる。initializeメソッ
ドを使えば、オブジェクトが生成された時に値を格納したりする事ができ
る。
</p>
</div>
</div>

<div id="outline-container-sec-1-7-1-8" class="outline-5">
<h5 id="sec-1-7-1-8">モジュールの先祖</h5>
<div class="outline-text-5" id="text-1-7-1-8">
<div class="org-src-container">

<pre class="src src-ruby">module GiantPanda
end
'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">module GiantPanda
  include Panda
end
'end'
</pre>
</div>


<div class="org-src-container">

<pre class="src src-ruby">(GiantPanda.class).ancestors
GiantPanda.ancestors
'end'
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-7-2" class="outline-4">
<h4 id="sec-1-7-2">meta</h4>
<div class="outline-text-4" id="text-1-7-2">
</div><div id="outline-container-sec-1-7-2-1" class="outline-5">
<h5 id="sec-1-7-2-1">クラス</h5>
<div class="outline-text-5" id="text-1-7-2-1">
<ul class="org-ul">
<li>インスタンス化能力を持つ。
</li>
<li>インスタンスメソッドを格納できる。
</li>

<li>クラスもオブジェクトである。
</li>
<li>クラスメソッドを格納できる。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-7-2-2" class="outline-5">
<h5 id="sec-1-7-2-2">モジュール</h5>
<div class="outline-text-5" id="text-1-7-2-2">
<ul class="org-ul">
<li>インスタンス化能力は持たない
</li>
<li>インスタンスメソッドを格納できる
</li>

<li>モジュールもオブジェクトである。
</li>
<li>クラスメソッドを格納できる
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-7-2-3" class="outline-5">
<h5 id="sec-1-7-2-3">Class と Module</h5>
<div class="outline-text-5" id="text-1-7-2-3">
<div class="org-src-container">

<pre class="src src-ruby">Class.class
Class.ancestors
C = Class.new
C.class
C.ancestors
c = C.new
c.class
c.ancestors
'end'
</pre>
</div>

<p>
定数 Class はクラス(クラス型のオブジェクト)である。
</p>
<ul class="org-ul">
<li>C = Class.new は，クラス(クラス型のオブジェクト)を生成する

<pre class="example">
[Class, Module, Object, Kernel, BasicObject] 
</pre>
</li>

<li>C.new は，オブジェクトを生成する
</li>
<li>Class と C では new の振る舞いは異なる
</li>
</ul>

<p>
定数 Module はクラスでありクラス型のオブジェクトである。
</p>
<ul class="org-ul">
<li>Module = Class.new(Object)
</li>
</ul>

<p>
あるオブジェクト obj が クラス型であるとは，
(obj.class).ancestors に Class が含まれること
</p>
</div>
</div>

<div id="outline-container-sec-1-7-2-4" class="outline-5">
<h5 id="sec-1-7-2-4">クラス - モジュール</h5>
<div class="outline-text-5" id="text-1-7-2-4">
<ul class="org-ul">
<li>インスタンス化能力
</li>
</ul>

<div class="org-src-container">

<pre class="src src-ruby">(Class.new).class
(Module.new).class

(Class.new).new
(Module.new).new

(Class.new).ancestors - (Module.new).ancestors
(Class.new).ancestors
(Module.new).ancestors

(Class).ancestors - (Module).ancestors

'end'
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> メタプログラミング</h3>
<div class="outline-text-3" id="text-1-8">
</div><div id="outline-container-sec-1-8-0-1" class="outline-5">
<h5 id="sec-1-8-0-1">2016.01.25 オブジェクトモデル</h5>
<div class="outline-text-5" id="text-1-8-0-1">
</div><div id="outline-container-sec-1-8-0-1-1" class="outline-6">
<h6 id="sec-1-8-0-1-1">class定義</h6>
<div class="outline-text-6" id="text-1-8-0-1-1">
<div class="org-src-container">

<pre class="src src-ruby">what_is_self_in_class_def =
 class MyClass
   CONSTANT = 'MyClassの定数'
   self
 end
p what_is_self_in_class_def
'end'
</pre>
</div>

<pre class="example">
irb(main):002:0* irb(main):003:1&gt; irb(main):004:1&gt; irb(main):005:1&gt; =&gt; MyClass
MyClass
=&gt; MyClass
</pre>

<p>
<code>class MyClass</code> は, 
</p>
<ul class="org-ul">
<li>=Class=型のオブジェクトを生成し，
</li>
<li>定数 <code>MyClass</code> にその値をセットし，
</li>
<li>self を <code>MyClass</code> オブジェクトにし，
</li>
<li>self のトップレベルで，
</li>
<li><code>end</code> までの ruby 式を評価し，
</li>
<li>最後の式の値を返す。
</li>
</ul>

<div class="org-src-container">

<pre class="src src-ruby">class MyClass
  p CONSTANT
  KONSTANT = 'MyClassの別の定数'
end
p CONSTANT
p MyClass::CONSTANT
p MyClass::KONSTANT
MyClass.constants

'end'
</pre>
</div>

<pre class="example">
irb(main):012:1&gt; irb(main):013:1&gt; "MyClassの定数"
=&gt; "MyClassの別の定数"
NameError: uninitialized constant CONSTANT
	from (irb):14
	from /home/staff/suzuki/.rbenv/versions/2.0.0-dev/bin/irb:11:in `&lt;main&gt;'
"MyClassの定数"
=&gt; "MyClassの定数"
"MyClassの別の定数"
=&gt; "MyClassの別の定数"
=&gt; [:CONSTANT, :KONSTANT]
</pre>

<ul class="org-ul">
<li><code>class MyClass</code> で，=MyClass= (クラス)オブジェクトのトップレベルに入
る
</li>
<li>ruby のクラスは変更に対し，開かれている (オープン・クラス)
</li>
<li>▼定数=CONSTANT= はMyClass の名前空間に定義されている
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-1-8-0-1-2" class="outline-6">
<h6 id="sec-1-8-0-1-2">object のクラス階層</h6>
<div class="outline-text-6" id="text-1-8-0-1-2">
<div class="org-src-container">

<pre class="src src-ruby">obj= MyClass.new
obj.class
(obj.class).ancestors
'end'
</pre>
</div>

<pre class="example">
=&gt; #&lt;MyClass:0x007fd4425309d0&gt;
=&gt; MyClass
=&gt; [MyClass, Object, Kernel, BasicObject]
</pre>

<p>
objの型
</p>
</div>
</div>

<div id="outline-container-sec-1-8-0-1-3" class="outline-6">
<h6 id="sec-1-8-0-1-3">クラスのクラス階層</h6>
<div class="outline-text-6" id="text-1-8-0-1-3">
<div class="org-src-container">

<pre class="src src-ruby">MyClass.class
(MyClass.class).ancestors
'end'
</pre>
</div>

<pre class="example">
=&gt; Class
=&gt; [Class, Module, Object, Kernel, BasicObject]
</pre>

<p>
MyClassのオブジェクトとしての型階層
</p>
</div>
</div>

<div id="outline-container-sec-1-8-0-1-4" class="outline-6">
<h6 id="sec-1-8-0-1-4">メタクラスのクラス階層</h6>
<div class="outline-text-6" id="text-1-8-0-1-4">
<div class="org-src-container">

<pre class="src src-ruby">MyClass.singleton_class
(MyClass.singleton_class).ancestors
'end'
</pre>
</div>

<pre class="example">
=&gt; #&lt;Class:MyClass&gt;
=&gt; [#&lt;Class:MyClass&gt;, #&lt;Class:Object&gt;, #&lt;Class:BasicObject&gt;, Class, Module, Object, Kernel, BasicObject]
</pre>

<p>
MyClassのオブジェクトとしての型階層
</p>
</div>
</div>
<div id="outline-container-sec-1-8-0-1-5" class="outline-6">
<h6 id="sec-1-8-0-1-5">特異クラスと特異メソッド</h6>
<div class="outline-text-6" id="text-1-8-0-1-5">
</div><div id="outline-container-sec-1-8-0-1-5-1" class="outline-7">
<h7 id="sec-1-8-0-1-5-1">特異メソッド</h7>
<div class="outline-text-7" id="text-1-8-0-1-5-1">
<p>
あるオブジェクトにだけ実行できるメソッドを定義できる:
</p>
<div class="org-src-container">

<pre class="src src-ruby">obj1 = Object.new
obj2 = Object.new
def obj1.m
  "obj's singleton method"
end

obj1.m
obj2.m

obj1.methods.include?(:m)
obj2.methods.include?(:m)

'end'
</pre>
</div>

<pre class="example">
=&gt; #&lt;Object:0x007f5711dd60e8&gt;
=&gt; #&lt;Object:0x007f5711daf420&gt;
irb(main):004:1&gt; irb(main):005:1&gt; =&gt; :m
irb(main):007:0* =&gt; "obj's singleton method"
NoMethodError: undefined method `m' for #&lt;Object:0x007f5711daf420&gt;
	from (irb):8
	from /home/staff/suzuki/.rbenv/versions/2.0.0-dev/bin/irb:11:in `&lt;main&gt;'
irb(main):010:0* =&gt; true
=&gt; false
</pre>
</div>
</div>

<div id="outline-container-sec-1-8-0-1-5-2" class="outline-7">
<h7 id="sec-1-8-0-1-5-2"><code>m</code> は何処にあるか？</h7>
<div class="outline-text-7" id="text-1-8-0-1-5-2">
<ul class="org-ul">
<li>obj1とobj2 の <code>class</code> は，Object. 
</li>
<li><code>class</code> はリンク。
</li>
<li>obj1 から Object へのリンクの途中に在る
</li>
</ul>

<div class="org-src-container">

<pre class="src src-ruby">obj1.class
obj1.singleton_class
(obj1.singleton_class).class
(obj1.singleton_class).instance_methods(false)
'end'
</pre>
</div>

<pre class="example">
=&gt; Object
=&gt; #&lt;Class:#&lt;Object:0x007f5711dd60e8&gt;&gt;
=&gt; Class
=&gt; [:m]
</pre>


<p>
<code>m</code> の居場所は，#&lt;Class:#&lt;Object:0x007f5711dd60e8&gt;&gt; 特異クラス
</p>

<div class="org-src-container">

<pre class="src src-ruby">'end'
</pre>
</div>


<div class="org-src-container">

<pre class="src src-ruby">MyClass.ancestors.each do |k|
  if k.singleton_class
    print k, ": ", (k.singleton_class).instace_methods, "\n"

'end'
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-1-8-0-1-6" class="outline-6">
<h6 id="sec-1-8-0-1-6">test class hier</h6>
<div class="outline-text-6" id="text-1-8-0-1-6">
<div class="org-src-container">

<pre class="src src-ruby">def find_instance_method(klass, method)
  prev = nil
  klass.ancestors.each do |k|
    break unless  k.instance_methods.include?(method)
    prev = k
  end
  return prev
end

def find_singleton_method(klass, method)
  prev = nil
  klass.ancestors.each do |k|
    break unless  k.instance_methods.include?(method)
    prev = k
  end
  return prev
end


find_instance_method(MyClass,:constants)
find_singleton_method(MyClass,:constants)
find_instance_method(Kernel,:constants)
find_singleton_method(Kernel,:constants)
find_instance_method(Module,:constants)
find_singleton_method(Module,:constants)
'end'
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-8-0-2" class="outline-5">
<h5 id="sec-1-8-0-2">2016.02.01 method</h5>
<div class="outline-text-5" id="text-1-8-0-2">
</div><div id="outline-container-sec-1-8-0-2-1" class="outline-6">
<h6 id="sec-1-8-0-2-1">method_missing</h6>
<div class="outline-text-6" id="text-1-8-0-2-1">
<ul class="org-ul">
<li>メソッド が class 階層中にない時，
</li>
<li>missing_method が呼ばれる
</li>
<li>class 階層中に missing_method がない時，
</li>
<li>エラーになる
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-8-0-2-2" class="outline-6">
<h6 id="sec-1-8-0-2-2">動的methodの仕組み</h6>
<div class="outline-text-6" id="text-1-8-0-2-2">
<ul class="org-ul">
<li>動的定義 define_method (:method_id) block
</li>
<li>動的呼び出し send("method", *args)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-8-0-2-3" class="outline-6">
<h6 id="sec-1-8-0-2-3">method_missing(method, *args)の利用</h6>
<div class="outline-text-6" id="text-1-8-0-2-3">
<ul class="org-ul">
<li>動的に未定義のメソッドと引数が取得できる
</li>
<li>他のメソッドへ委譲したり (動的proxy)
</li>
<li>メソッドを on-demand で定義できたり (ghost method)
<a href="file:///users/home/masayuki/COMM/Lects/meta-ruby/site/org-docs/meta-ruby/methods.html">openstruct</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-8-0-2-4" class="outline-6">
<h6 id="sec-1-8-0-2-4">最終形</h6>
<div class="outline-text-6" id="text-1-8-0-2-4">
<p>
様々なComputer の様々な付属品を扱う多種のデータベースへのアクセス
を簡単にする：
</p>

<ul class="org-ul">
<li><a href="file:///users/home/masayuki/COMM/Lects/meta-ruby/code/methods/computer/more_dynamic.rb">more_dynamic.rb</a>
</li>

<li><a href="file:///users/home/masayuki/COMM/Lects/meta-ruby/code/methods/computer/final.rb">final.rb</a>
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-1-8-0-3" class="outline-5">
<h5 id="sec-1-8-0-3">2016.02.09 ブロック</h5>
<div class="outline-text-5" id="text-1-8-0-3">
<p>
この章で理解すべきこと
</p>
<ul class="org-ul">
<li>スコープ
</li>
<li>クロージャ
</li>
<li>クロージャによるスコープの操作
</li>
<li>呼び出し可能オブジェクトへの変換
</li>
</ul>
</div>

<div id="outline-container-sec-1-8-0-3-1" class="outline-6">
<h6 id="sec-1-8-0-3-1">ブロックの基本</h6>
<div class="outline-text-6" id="text-1-8-0-3-1">
</div><div id="outline-container-sec-1-8-0-3-1-1" class="outline-7">
<h7 id="sec-1-8-0-3-1-1">ブロックの作成</h7>
<div class="outline-text-7" id="text-1-8-0-3-1-1">
<ul class="org-ul">
<li>do &#x2026; end が block 
</li>
<li>メソッド呼び出しの時のみ
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-8-0-3-1-2" class="outline-7">
<h7 id="sec-1-8-0-3-1-2">ブロックが与えられているか？</h7>
<div class="outline-text-7" id="text-1-8-0-3-1-2">
<ul class="org-ul">
<li>block_given? で調べられる
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-8-0-3-1-3" class="outline-7">
<h7 id="sec-1-8-0-3-1-3">ブロックの呼び出し</h7>
<div class="outline-text-7" id="text-1-8-0-3-1-3">
<ul class="org-ul">
<li>呼ばれたメソッド側で yield により呼び出せる
</li>
<li>しかし，block は，block が作られた*環境*で実行される
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-8-0-3-2" class="outline-6">
<h6 id="sec-1-8-0-3-2">クロージャ</h6>
<div class="outline-text-6" id="text-1-8-0-3-2">
</div><div id="outline-container-sec-1-8-0-3-2-1" class="outline-7">
<h7 id="sec-1-8-0-3-2-1">コードの実行</h7>
<div class="outline-text-7" id="text-1-8-0-3-2-1">
<ul class="org-ul">
<li>ブロックはコード
</li>

<li><b>self</b> が実行の主体 (場)

<ul class="org-ul">
<li>self は <b>環境</b> を持つ

<p>
環境は，スコープ上の変数とその値のペア(<b>束縛</b>)の集まり
</p>

<ul class="org-ul">
<li>局所変数 (一方向) のスコープ
<ul class="org-ul">
<li>block の入れ子構造 (nesting) のスコープ
</li>
</ul>
</li>

<li>インスタンス変数 (一通り) のスコープ
</li>

<li>クラス変数 (一通り) のスコープ
<ul class="org-ul">
<li>class の継承方向のスコープ
</li>
</ul>
</li>

<li>定数 (2方向)のスコープ
<ul class="org-ul">
<li>module の入れ子構造 (nesting) のスコープ
</li>
<li>class の継承方向のスコープ
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


<ul class="org-ul">
<li>クロージャ = block + self (環境)
</li>
</ul>


<ul class="org-ul">
<li>ブロックが生まれるとき，自身が生まれた環境を閉じ込めた ((<b>クロージャ</b>))
となる
</li>

<li>クロージャが実行される時は，その環境で実行される
<ul class="org-ul">
<li>定数はselfのクラスから辿れる
</li>
<li>インスタンス変数、特異メソッドには self から辿れる
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-8-0-3-2-2" class="outline-7">
<h7 id="sec-1-8-0-3-2-2">スコープのまとめ</h7>
<div class="outline-text-7" id="text-1-8-0-3-2-2">
<ul class="org-ul">
<li>Rubyのスコープには束縛がある
</li>
<li>スコープは class, module, def のスコープゲートで区切られ。
</li>
<li>スコープゲートは，Class.new(), Module.new(), Moduel#define_method()
で置き換え，それらに束縛を閉じこめたクロージャを与える。
</li>
<li>クロージャにより，束縛の共有も可能となる
</li>
</ul>

<p>
(<b>s</b>) この辺りは，SICP の lambda による実現の方が，シンプルでわかりや
すい。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-8-0-3-3" class="outline-6">
<h6 id="sec-1-8-0-3-3">instance_eval()</h6>
<div class="outline-text-6" id="text-1-8-0-3-3">
<dl class="org-dl">
<dt> obj.instance_eval block </dt><dd><ul class="org-ul">
<li>オブジェクトobjのコンテキストで, 
</li>
<li>ブロックblockを評価する
</li>
</ul>
</dd>

<dt> (no term) </dt><dd>obj を self にして, クロージャを実行するということ
</dd>
</dl>
</div>

<div id="outline-container-sec-1-8-0-3-3-1" class="outline-7">
<h7 id="sec-1-8-0-3-3-1">カプセル化の破壊</h7>
<div class="outline-text-7" id="text-1-8-0-3-3-1">
<p>
instance_eval を使うとカプセル化が破壊できる
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-8-0-3-4" class="outline-6">
<h6 id="sec-1-8-0-3-4">呼び出し可能オブジェクト</h6>
<div class="outline-text-6" id="text-1-8-0-3-4">
<p>
ブロックの使用
</p>
<ul class="org-ul">
<li>コードの保管
</li>
<li>yieldを使ったブロックの呼び出し
</li>
</ul>

<p>
コードを保管できる状況
</p>
<ul class="org-ul">
<li>(({Proc})) の中．ブロックがオブジェクトになる
</li>
<li>(({lambda})) の中．
</li>
<li>メソッドの中
</li>
</ul>
</div>

<ul class="org-ul"><li><a id="sec-1-8-0-3-4-0-1" name="sec-1-8-0-3-4-0-1"></a>Proc 対 lambda<br  /><div class="outline-text-8" id="text-1-8-0-3-4-0-1">
<p>
ブロックを Proc にする方法
</p>
<ul class="org-ul">
<li>Proc.new()
</li>
<li>lambda { }　
</li>
<li>&amp;修飾
</li>
</ul>
</div>

<ul class="org-ul"><li><a id="sec-1-8-0-3-4-0-1-1" name="sec-1-8-0-3-4-0-1-1"></a>Proc, lambda, return<br  /><div class="outline-text-9" id="text-1-8-0-3-4-0-1-1">
<p>
Proc のリターンは，Proc の定義された環境から return 
(直前の環境へ戻る)
</p>
</div>
</li>

<li><a id="sec-1-8-0-3-4-0-1-2" name="sec-1-8-0-3-4-0-1-2"></a>Proc, lambda, arity<br  /><div class="outline-text-9" id="text-1-8-0-3-4-0-1-2">
<p>
引数の確認方法の違い
</p>

<ul class="org-ul">
<li>lambda は厳格 (メソッドに準拠)
</li>
<li>Proc は柔軟
</li>
</ul>
</div>
</li>

<li><a id="sec-1-8-0-3-4-0-1-3" name="sec-1-8-0-3-4-0-1-3"></a>Proc対lambda: 判定<br  /><div class="outline-text-9" id="text-1-8-0-3-4-0-1-3">
<p>
lambda がメソッドに似ている <code>[/]</code>
</p>
<ol class="org-ol">
<li><code>[&#xa0;]</code> 項数に厳しく
</li>
<li><code>[&#xa0;]</code> return で自身を終える
</li>
</ol>

<p>
Proc はコンテキスト中のコードの一部，
lambda は独立したコード
</p>
</div>
</li></ul>
</li>

<li><a id="sec-1-8-0-3-4-0-2" name="sec-1-8-0-3-4-0-2"></a>メソッド再び<br  /><div class="outline-text-8" id="text-1-8-0-3-4-0-2">
<ul class="org-ul">
<li>Object#method() でメソッドを，Method オブジェクトとして取得可
</li>
<li>Method オブジェクトは，Method#call() で呼び出し可能
</li>
<li>Method オブジェクトは，属するオブジェクトのスコープで実行される
</li>
<li>Method#unbind() は属するオブジェクトを引き離し，UnboundMethod
オブジェクトが返る
</li>
<li>UnboundMethodはMethod#bind()でメソッドに戻せる
クラスが異なると，例外が発生
</li>
</ul>
</div>
</li>

<li><a id="sec-1-8-0-3-4-0-3" name="sec-1-8-0-3-4-0-3"></a>呼び出し可能オブジェクトのまとめ<br  /><div class="outline-text-8" id="text-1-8-0-3-4-0-3">
<p>
呼び出し可能オブジェクト <code>[/]</code>
</p>
<ol class="org-ol">
<li><code>[&#xa0;]</code> ブロック
<ul class="org-ul">
<li>オブジェクトではないが，呼び出し可能
</li>
<li>定義されたスコープで評価される
</li>
</ul>
</li>

<li><code>[&#xa0;]</code> Proc
<ul class="org-ul">
<li>定義されたスコープで評価される
</li>
<li>定義されたコンテキストの制御にしたがう
</li>
</ul>
</li>

<li><code>[&#xa0;]</code> lambda
<ul class="org-ul">
<li>Proc クラスのオブジェクト，クロージャ
</li>
<li>定義されたスコープで評価される
</li>
<li>独立した method のように振る舞う
</li>
</ul>
</li>

<li><code>[&#xa0;]</code> メソッド
<ul class="org-ul">
<li>オブジェクトにつながれ，
</li>
<li>オブジェクトのスコープで評価される
</li>
</ul>
</li>
</ol>
</div>
</li></ul>
</div>
</div>




<div id="outline-container-sec-1-8-1" class="outline-4">
<h4 id="sec-1-8-1">memo コード</h4>
<div class="outline-text-4" id="text-1-8-1">
</div><div id="outline-container-sec-1-8-1-1" class="outline-5">
<h5 id="sec-1-8-1-1">class 階層</h5>
<div class="outline-text-5" id="text-1-8-1-1">
<div class="org-src-container">

<pre class="src src-ruby">1.class
(1.class).superclass
(1.class).superclass.superclass
(1.class).superclass.superclass.superclass
(1.class).superclass.superclass.superclass.superclass
(1.class).superclass.superclass.superclass.superclass.superclass
'end'
</pre>
</div>


<div class="org-src-container">

<pre class="src src-ruby">1.methods
(Object.new).methods
(BasicObject.new).methods
'end'
</pre>
</div>

<ul class="org-ul">
<li>method メソッドはBasicObjectのインスタンス・メソッドではない
</li>
<li>method メソッドはObjectのインスタンス・メソッド
</li>
</ul>

<div class="org-src-container">

<pre class="src src-ruby">(1.class).ancestors
(Object.instance_methods).include?(:methods)
(Kernel.instance_methods).include?(:methods)
(BasicObject.instance_methods).include?(:methods)
'end'
</pre>
</div>


<div class="org-src-container">

<pre class="src src-ruby">(1.class)
((1.class).class)
((1.class).class).superclass
((1.class).class).superclass.superclass
((1.class).class).superclass.superclass.superclass
((1.class).class).superclass.superclass.superclass.superclass
:end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">Class
(Class.class)
(Class.class).superclass
(Class.class).superclass.superclass
(Class.class).superclass.superclass.superclass
(Class.class).superclass.superclass.superclass.superclass
:end
</pre>
</div>
<p>
Class
Class
Module
Object
BasicObject
nil
</p>

<div class="org-src-container">

<pre class="src src-ruby">Module
(Module.class)
(Module.class).superclass
(Module.class).superclass.superclass
(Module.class).superclass.superclass.superclass
(Module.class).superclass.superclass.superclass.superclass
:end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">def class_hier(obj)
  if obj.superclass
    print " =&gt; ", obj.superclass
    class_hier(obj.superclass)
  end
end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">class_hier(Class)
class_hier(Integer)

'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">Class.singleton_class
(Class.singleton_class).superclass
(Class.singleton_class).superclass.superclass
(Class.singleton_class).superclass.superclass.superclass
(Class.singleton_class).superclass.superclass.superclass.superclass
:end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">(Class.singleton_class).singleton_class
(Class.singleton_class).singleton_class.singleton_class
:end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">(Class.singleton_class).singleton_class
(Class.singleton_class).singleton_class.superclass
(Class.singleton_class).singleton_class.superclass.superclass
(Class.singleton_class).singleton_class.superclass.superclass.superclass
:end
</pre>
</div>


<div class="org-src-container">

<pre class="src src-ruby">Class.ancestors
Module.ancestors
(Class.new).ancestors
(Module.new).ancestors
'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">Class.singleton_class
(Class.singleton_class).ancestors
'end'
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-8-1-2" class="outline-5">
<h5 id="sec-1-8-1-2">self</h5>
<div class="outline-text-5" id="text-1-8-1-2">
<div class="org-src-container">

<pre class="src src-ruby">self
self.class

class H
  $selfH = self
  def m
    $selfm = self
    puts "m is called."
    'm'
  end
end
print "$selfH = ", $selfH
h = H.new
h.m
print "$selfm = ", $selfm
:end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-8-1-3" class="outline-5">
<h5 id="sec-1-8-1-3">methods</h5>
<div class="outline-text-5" id="text-1-8-1-3">
<div class="org-src-container">

<pre class="src src-ruby">1.methods - (Numeric.new).methods
Integer(1001)
String("abc")
Array(2)
Array(1..100)
Kernel.Array(2)
self.Array(2)


'end'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">Kernel.methods.include?(:Array)
Kernel.methods.include?(:Integer)
'end'
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> sqlite3</h3>
</div>

<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> sqlite3-ruby</h3>
<div class="outline-text-3" id="text-1-10">
</div><div id="outline-container-sec-1-10-1" class="outline-4">
<h4 id="sec-1-10-1">関連サイト</h4>
<div class="outline-text-4" id="text-1-10-1">
<ul class="org-ul">
<li><a href="http://shuzo-kino.hateblo.jp/entry/20120913/1347551619">Rubyでsqlite3を使ってみる - Bye Bye Moore</a>
</li>
<li><a href="https://sites.google.com/site/rubycocoamemo/Home/ruby-guan-lian/sqlite-wo--ruby-de-tsukau">SQLite を Ruby で使う - RubyCocoa メモ</a>
</li>
<li><a href="https://github.com/sparklemotion/sqlite3-ruby">sparklemotion/sqlite3-ruby - Ruby</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-10-2" class="outline-4">
<h4 id="sec-1-10-2">gem</h4>
<div class="outline-text-4" id="text-1-10-2">
<div class="org-src-container">

<pre class="src src-sh">gem install sqlite3
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-10-3" class="outline-4">
<h4 id="sec-1-10-3">sqlite</h4>
<div class="outline-text-4" id="text-1-10-3">
<p>
<i>SQLite (wikipedia)</i> 手軽なローカル・ファイル型の軽量データベース
</p>
</div>
</div>

<div id="outline-container-sec-1-10-4" class="outline-4">
<h4 id="sec-1-10-4">setup</h4>
<div class="outline-text-4" id="text-1-10-4">
<div class="org-src-container">

<pre class="src src-sh">rm -f database.db
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-10-5" class="outline-4">
<h4 id="sec-1-10-5">ruby</h4>
<div class="outline-text-4" id="text-1-10-5">
<div class="org-src-container">

<pre class="src src-ruby"># coding: utf-8

require 'rubygems'
require 'sqlite3'

db = SQLite3::Database.new("database.db")

sql = &lt;&lt;EOT
create table Person (
 name varchar(10),
 age integer,
 post varchar(200)
);
EOT

db.execute(sql)
puts "New file is created."

db.transaction do
  sql = "insert into Person values (?, ?, ?)"
  db.execute(sql, 'hoge', 26, 'hage')
  db.execute(sql, 'hage', 62, 'hoge')
end

db.execute('select * from Person') do |row|
  puts row.join("\t")
end
db.close

'end'
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-10-6" class="outline-4">
<h4 id="sec-1-10-6">firefox sqlite database handling</h4>
<div class="outline-text-4" id="text-1-10-6">
<p>
<a href="https://support.mozilla.org/ja/kb/profiles-where-firefox-stores-user-data#w_cucgciaaacceaeakiuaiauadaeaoceag">プロファイル | Firefox ヘルプ</a> 
</p>

<p>
firefox が使っている sqlite データベースをコピーして，
テーブルのレコードを出力する。
</p>

<div class="org-src-container">

<pre class="src src-sh">ls ~/.mozilla/firefox
cp -p ~/.mozilla/firefox/5rot7npz.default/content-prefs.sqlite .
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby"># coding: utf-8

require 'rubygems'
require 'sqlite3'
require 'pp'

file = "content-prefs.sqlite"

db = SQLite3::Database.open(file)

tables = db.execute("select tbl_name FROM sqlite_master WHERE type == 'table'")

tables.flatten.each do |tbl|
  puts "== ",  tbl
  db.results_as_hash = true
  db.execute("select * from #{tbl}") do |row|
    # puts row.join("\t")
    pp row
  end
end

p tables

db.close

'end'
</pre>
</div>


<p>
<a href="https://www.dropbox.com/s/kf035hpu5r7dkqo/._%20(Masayuki%20Suzuki%20%E3%81%AE%E7%AB%B6%E5%90%88%E3%82%B3%E3%83%94%E3%83%BC%202016-01-07%20(3))._Icon%0D?dl=0">https://www.dropbox.com/s/kf035hpu5r7dkqo/._%20(Masayuki%20Suzuki%20%E3%81%AE%E7%AB%B6%E5%90%88%E3%82%B3%E3%83%94%E3%83%BC%202016-01-07%20(3))._Icon%0D?dl=0</a>
</p>
</div>
</div>


<div id="outline-container-sec-1-10-7" class="outline-4">
<h4 id="sec-1-10-7">firefox sqlite database handling 2</h4>
<div class="outline-text-4" id="text-1-10-7">
<div class="org-src-container">

<pre class="src src-sh">ls -l ~/.mozilla/firefox/*/*sqlite
</pre>
</div>

<ul class="org-ul">
<li>*.sqlite3 をみんな出力してみましょう。
</li>
<li>lock されて開けないのもあるので，エラー処理をしましょう。
</li>
<li>出力には，=pp= を使いましょう。
</li>
<li>各dbの master record を読んでみましょう。
</li>
</ul>

<div class="org-src-container">

<pre class="src src-ruby">require 'rubygems'
require 'sqlite3'
require 'pp'

# dir = '/users/home/masayuki/.mozilla/firefox/1dtrhim2.default-1450953083451/'
dir = '/home/staff/suzuki/.mozilla/firefox/5rot7npz.default/'
Dir.chdir(dir) do
  Dir.glob("*.sqlite").each do |db|
    puts "** #{db}"
    begin
      db = SQLite3::Database.open(db)
      results = db.execute("select * from sqlite_master")
      pp results
    rescue  =&gt; e
      puts e
    end
  end
end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">ruby babel/sqlite3-master.rb
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-10-8" class="outline-4">
<h4 id="sec-1-10-8"></h4>
<div class="outline-text-4" id="text-1-10-8">
<div class="org-src-container">

<pre class="src src-ruby"># coding: utf-8

require 'rubygems'
require 'sqlite3'

file = "content-prefs.sqlite"

db = SQLite3::Database.open(file)

tables = db.execute("select tbl_name FROM sqlite_master WHERE type == 'table'")

tables.flatten.each do |tbl|
  puts "== ",  tbl
  db.execute("select * from #{tbl}") do |row|
    puts row.join("\t")
  end
end

p tables

db.close

'end'
</pre>
</div>


<p>
<a href="https://www.dropbox.com/s/kf035hpu5r7dkqo/._%20(Masayuki%20Suzuki%20%E3%81%AE%E7%AB%B6%E5%90%88%E3%82%B3%E3%83%94%E3%83%BC%202016-01-07%20(3))._Icon%0D?dl=0">https://www.dropbox.com/s/kf035hpu5r7dkqo/._%20(Masayuki%20Suzuki%20%E3%81%AE%E7%AB%B6%E5%90%88%E3%82%B3%E3%83%94%E3%83%BC%202016-01-07%20(3))._Icon%0D?dl=0</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> sinatra-org</h3>
</div>
<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12"><span class="section-number-3">1.12</span> references</h3>
<div class="outline-text-3" id="text-1-12">
<ul class="org-ul">
<li>~suzuki/COMM/Lects/meta-ruby/site/lects/note/sinatra-org/readme.org (self)
</li>
<li><a href="http://ops.tokyo/posts/2014/12/12/using-org-babel-for-lp-jp/">OrgBabelで文芸的プログラミング · ops●tokyo</a>
</li>
<li><a href="http://www.sinatrarb.com/intro-ja.html">Sinatra: README (Japanese)</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-13" class="outline-3">
<h3 id="sec-1-13"><span class="section-number-3">1.13</span> what</h3>
<div class="outline-text-3" id="text-1-13">
<p>
./notes にある .org 文書を表示する Webサービスを作成する。
</p>
</div>
</div>

<div id="outline-container-sec-1-14" class="outline-3">
<h3 id="sec-1-14"><span class="section-number-3">1.14</span> how</h3>
<div class="outline-text-3" id="text-1-14">
<ul class="org-ul">
<li>rubygems の sinatra，org-convergeを用いる
</li>

<li>readme.org に全てを記述する
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-15" class="outline-3">
<h3 id="sec-1-15"><span class="section-number-3">1.15</span> directory</h3>
<div class="outline-text-3" id="text-1-15">
<pre class="example">
.
+-- readme.org 
|
+-- org +-- run.org
|
+-- src +-- app.rb
|       +-- Gemfile
|       +-- config.ru
|
+-- notes@
</pre>
</div>
</div>

<div id="outline-container-sec-1-16" class="outline-3">
<h3 id="sec-1-16"><span class="section-number-3">1.16</span> sinatraのための設定</h3>
<div class="outline-text-3" id="text-1-16">
</div><div id="outline-container-sec-1-16-1" class="outline-4">
<h4 id="sec-1-16-1">bundler</h4>
<div class="outline-text-4" id="text-1-16-1">
<p>
bundler を gem install
</p>

<div class="org-src-container">

<pre class="src src-sh">gem install bundler
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-16-2" class="outline-4">
<h4 id="sec-1-16-2">gemfile</h4>
<div class="outline-text-4" id="text-1-16-2">
<p>
必要な gem を記述
</p>

<div class="org-src-container">

<pre class="src src-ruby"># src/Gemfile
gem 'sinatra'
gem 'org-converge'
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-16-3" class="outline-4">
<h4 id="sec-1-16-3">config.ru</h4>
<div class="outline-text-4" id="text-1-16-3">
<p>
sinatraアプリケーションを起動するための設定
</p>

<div class="org-src-container">

<pre class="src src-ruby"># src/config.ru
require './app.rb'
run Sinatra::Application
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-17" class="outline-3">
<h3 id="sec-1-17"><span class="section-number-3">1.17</span> service</h3>
<div class="outline-text-3" id="text-1-17">
</div><div id="outline-container-sec-1-17-1" class="outline-4">
<h4 id="sec-1-17-1">application</h4>
<div class="outline-text-4" id="text-1-17-1">
<p>
sinatra のDSLで，Webサービスを記述:
</p>

<div class="org-src-container">

<pre class="src src-ruby"># src/app.rb
require 'sinatra'

get '/' do
  'OK'
end

get '/org' do
  Dir.glob('../notes/*.org').join("\n")
end

get '/org/*.org' do |doc|
  `(cd ../notes; org2html #{doc}.org)`
  `cat ../notes/#{doc}.html`
end
</pre>
</div>

<p>
ここでは，org-&gt;HTML変換には，~suzuki/COMM/bin/org2html コマンドを利用しています。
</p>

<p>
代わりに，((% pandoc -f html -t org %))コマンドを使ってもいいですし，
rubygem/org-ruby を使ってもいいかもしれません。
</p>
</div>
</div>

<div id="outline-container-sec-1-17-2" class="outline-4">
<h4 id="sec-1-17-2">起動</h4>
<div class="outline-text-4" id="text-1-17-2">
<p>
この文書を，emacs org-mode で C-c C-v C-t して，書き出し，
下記コマンドでサーバを立ち上げる。
</p>

<div class="org-src-container">

<pre class="src src-sh">org-converge org/run.org
</pre>
</div>
</div>

<div id="outline-container-sec-1-17-2-1" class="outline-5">
<h5 id="sec-1-17-2-1">確認</h5>
<div class="outline-text-5" id="text-1-17-2-1">
<p>
ブラウザで，下記URLにアクセスする:
</p>
<ul class="org-ul">
<li>127.0.0.1:9292/, 
</li>
<li>127.0.0.1:9292/org, 
</li>
<li>127.0.0.1:9292/org/ORG文書
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-17-2-2" class="outline-5">
<h5 id="sec-1-17-2-2">起動用 org 文書 (org/run.org)</h5>
<div class="outline-text-5" id="text-1-17-2-2">
<div class="org-src-container">

<pre class="src src-org">#+title: running the application
#+include "org/app.org"

** run it

#+name: server
#+BEGIN_SRC sh :dir src

bundle install
bundle exec rackup

#+END_SRC

** access

#+name: getit
#+BEGIN_SRC sh :wait 1

  curl 127.0.0.1:9292/ 2&gt;/dev/null
  sleep 2
  curl 127.0.0.1:9292/org  2&gt;/dev/null
  sleep 2
  curl 127.0.0.1:9292/org/ruby-note.org  2&gt;/dev/null
  sleep 2

#+END_SRC
</pre>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> memo</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> memo</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">Doing test-unit</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
単体テストの使い方をまとめました。
</p>

<p>
<a href="file:///users/home/masayuki/COMM/Lects/meta-ruby/git/org/~suzuki/COMM/Lects/meta-ruby/site/lects/note/ruby-note-test.html">file:///users/home/masayuki/COMM/Lects/meta-ruby/git/org/~suzuki/COMM/Lects/meta-ruby/site/lects/note/ruby-note-test.html</a>
</p>
</div>
</div>


<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2">Doing poker.org</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
~suzuki/COMM/Lects/meta-ruby/site/lects/poker の下に org 文書を作り
ました。
</p>
</div>
</div>

<div id="outline-container-sec-2-1-3" class="outline-4">
<h4 id="sec-2-1-3">global</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
<a href="http://www.machu.jp/diary/20090307.html#p01">ソースコードを快適に読むための GNU GLOBAL 入門 (前編) - まちゅダイアリー(2009-03-07)</a>
<a href="http://horoama.hatenablog.com/entry/2015/05/16/183359">globalを使いブラウザで快適にソースコードを読む - ほろあま記念館</a>
</p>


<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">&lt;2015-12-13 日&gt;</span></span> ~suzuki/public_html/Documents/ruby20に置きました。が，cgi動かず。
</li>

<li>global-6.5.1 install しました。
<ul class="org-ul">
<li>~suzuki/local/bin/gtags
</li>
</ul>
</li>

<li>ruby-2.0.0-p353 download し，gtags, htags しておきました。
<ul class="org-ul">
<li>~suzuki/working/ruby20/ruby-2.0.0-p353
</li>
</ul>
</li>
</ul>

<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/ruby20/">ruby-2.0.0-p353</a> ソースコードをHTML化したもの
</p>
</div>
</div>

<div id="outline-container-sec-2-1-4" class="outline-4">
<h4 id="sec-2-1-4">ソースコード解説</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~wiki/rhg.cgi?%E8%AC%9B%E7%BE%A9%E5%86%85%E5%AE%B9">R.H.G. Wikky - 講義内容</a> 
</p>

<p>
<a href="http://i.loveruby.net/ja/rhg/book/">Rubyソースコード完全解説</a>
</p>
</div>
</div>


<div id="outline-container-sec-2-1-5" class="outline-4">
<h4 id="sec-2-1-5">ソースコード pry-doc</h4>
<div class="outline-text-4" id="text-2-1-5">
<p>
<a href="http://qiita.com/joker1007/items/42f00b12c65bbec0e50a">pry-docでカジュアルにRubyのソースコードを読む - Qiita</a>
</p>
</div>
</div>


<div id="outline-container-sec-2-1-6" class="outline-4">
<h4 id="sec-2-1-6">EmacsでPATHの設定が引き継がれない問題をエレガントに解決する - Qiita</h4>
<div class="outline-text-4" id="text-2-1-6">
<p>
<a href="http://qiita.com/catatsuy/items/3dda714f4c60c435bb25">http://qiita.com/catatsuy/items/3dda714f4c60c435bb25</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-7" class="outline-4">
<h4 id="sec-2-1-7">gem install spreadsheet for meta-ruby</h4>
</div>

<div id="outline-container-sec-2-1-8" class="outline-4">
<h4 id="sec-2-1-8">meta-ruby 講義内容</h4>
<div class="outline-text-4" id="text-2-1-8">
<ul class="org-ul">
<li>meta な説明
<ul class="org-ul">
<li>meta programming
</li>
</ul>
</li>
<li>class library を使った ruby プログラミング
</li>
<li>OO
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-1-9" class="outline-4">
<h4 id="sec-2-1-9">Done .ob org-mode #+babel_include の導入&#xa0;&#xa0;&#xa0;<span class="tag"><span class="include">include</span>&#xa0;<span class="babel">babel</span>&#xa0;<span class="org">org</span></span></h4>
<div class="outline-text-4" id="text-2-1-9">
</div><div id="outline-container-sec-2-1-9-1" class="outline-5">
<h5 id="sec-2-1-9-1">why</h5>
<div class="outline-text-5" id="text-2-1-9-1">
<p>
include ファイル中の named_src_block の noweb 参照ができない
</p>
</div>
</div>
<div id="outline-container-sec-2-1-9-2" class="outline-5">
<h5 id="sec-2-1-9-2">how</h5>
<div class="outline-text-5" id="text-2-1-9-2">
<ul class="org-ul">
<li>同一ファイル中の named_src_block は noweb 参照ができるので，
include を展開することにした。
</li>
<li>通常の include は展開したくないので， babel_include だけ展開する
ことにした。
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-1-9-3" class="outline-5">
<h5 id="sec-2-1-9-3">script</h5>
<div class="outline-text-5" id="text-2-1-9-3">
<div class="org-src-container">

<pre class="src src-ruby">#!/usr/bin/env ruby
# coding: utf-8
def org_babel_expand_include (file)
  File.open(file, 'r:utf-8') do |io|
    io.read.each_line do |line| 
      if line =~ /^#\+babel_include:\s*(\S+)/
	org_babel_expand_include($1)
      else
	print line
      end
    end
  end
end

if __FILE__ == $0
  org_babel_expand_include(ARGV[0])
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-1-9-4" class="outline-5">
<h5 id="sec-2-1-9-4">working directory</h5>
<div class="outline-text-5" id="text-2-1-9-4">
<p>
<a href="file:///users/home/masayuki/COMM/Prog/org/babel-include/">file:///users/home/masayuki/COMM/Prog/org/babel-include/</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-1-10" class="outline-4">
<h4 id="sec-2-1-10">Doing org-tangle&#xa0;&#xa0;&#xa0;<span class="tag"><span class="auto">auto</span>&#xa0;<span class="tangle">tangle</span>&#xa0;<span class="babel">babel</span>&#xa0;<span class="org">org</span></span></h4>
<div class="outline-text-4" id="text-2-1-10">
</div><div id="outline-container-sec-2-1-10-1" class="outline-5">
<h5 id="sec-2-1-10-1">tangle を make できるように</h5>
<div class="outline-text-5" id="text-2-1-10-1">
</div><div id="outline-container-sec-2-1-10-1-1" class="outline-6">
<h6 id="sec-2-1-10-1-1">ruby gem org-converge 中の org-tangle</h6>
<div class="outline-text-6" id="text-2-1-10-1-1">
<p>
:nowebの機能が使えないので，あきらめる
</p>
</div>
</div>

<div id="outline-container-sec-2-1-10-1-2" class="outline-6">
<h6 id="sec-2-1-10-1-2">シェルコマンド化</h6>
<div class="outline-text-6" id="text-2-1-10-1-2">
<p>
<a href="file:///users/home/masayuki/bin/org2html">org2html</a> と同様に， org_tangle を作成
</p>

<p>
Makefile 中の tab が展開されるので， config/emacs-org.el を読むよ
うにする
</p>

<div class="org-src-container">

<pre class="src src-shell">#!/usr/bin/env bash
# http://blog.nguyenvq.com/2010/10/30/bash-batch-script-to-convert-org-mode-file-to-html/
# orgdir=/r/src/org-mode/lisp/    # Git版org-modeのディレクトリ
# opts="-l ~/.org2html-batch.el"  # カスタマイズしなければ "" にする
opts="-l ~/.emacs.d/config/emacs-org.el"
f=""
for file in "$@"
do
#    f="${f} --visit ${file} --funcall org-export-as-html-batch"
#    f="${f} --visit ${file} --funcall org-html-export-as-html"
    f="${f} --visit ${file} --funcall org-babel-tangle"
done
# Emacs標準添付のorg-modeを使う場合はこっち
~/bin/emacs --batch -l org $opts $f
#~/bin/emacs --batch -q --no-site-file -l org $opts $f
# Git版org-modeを使う場合はこっち
# emacs --batch -q --no-site-file -L $orgdir -l org $opts $f
</pre>
</div>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2015-11-26 木 06:06]</span></span>
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-2-1-11" class="outline-4">
<h4 id="sec-2-1-11">new org-mode babel-include を展開する</h4>
<div class="outline-text-4" id="text-2-1-11">
<p>
<a href="file:///users/home/masayuki/COMM/Prog/org/babel-include/">file:///users/home/masayuki/COMM/Prog/org/babel-include/</a> 
</p>

<p>
~/COMM/bin/babel-expand.rb
</p>
</div>
</div>

<div id="outline-container-sec-2-1-12" class="outline-4">
<h4 id="sec-2-1-12">ruby 日本語</h4>
<div class="outline-text-4" id="text-2-1-12">
<p>
ruby -K [e|s|u|n] euc-jp|cp932|utf-8|ascii-8
</p>

<p>
<a href="http://docs.ruby-lang.org/ja/2.2.0/doc/spec=2fm17n.html">多言語化 (Ruby 2.2.0)</a>
</p>

<p>
<a href="http://docs.ruby-lang.org/ja/2.2.0/class/Encoding.html">class Encoding (Ruby 2.2.0)</a>
</p>

<p>
internal_encoding, external_encoding
default_ &#x2026;
magic comment
</p>

<div class="org-src-container">

<pre class="src src-ruby"># coding:utf-8
</pre>
</div>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2015-11-16 月 11:01]</span></span>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-13" class="outline-4">
<h4 id="sec-2-1-13">ruby入門のサイトを変更したい</h4>
<div class="outline-text-4" id="text-2-1-13">
<p>
<a href="http://www.rubylife.jp/ini/">Ruby入門</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-14" class="outline-4">
<h4 id="sec-2-1-14">org babelを調べる</h4>
<div class="outline-text-4" id="text-2-1-14">
<p>
<a href="file:///NFS/ufs/mac/masayuki/COMM/working/ob-ruby.html">file:///NFS/ufs/mac/masayuki/COMM/working/ob-ruby.html</a>
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2015-11-16 月 09:43]</span></span>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-15" class="outline-4">
<h4 id="sec-2-1-15">meta-ruby</h4>
<div class="outline-text-4" id="text-2-1-15">
<p>
クラス・モジュールの概念 Ruby - Qiita
<a href="http://qiita.com/ToruFukui/items/2dd4d2d1ce6ed05928de">http://qiita.com/ToruFukui/items/2dd4d2d1ce6ed05928de</a>
</p>

<p>
カレントオブジェクトselfについて Ruby - Qiita
<a href="http://qiita.com/ToruFukui/items/be29968da6dc9d125315">http://qiita.com/ToruFukui/items/be29968da6dc9d125315</a>
</p>

<p>
誤解されている 6 つの Ruby の機能の真相を知る
<a href="http://www.ibm.com/developerworks/jp/opensource/library/os-sixrubyfeatures/">http://www.ibm.com/developerworks/jp/opensource/library/os-sixrubyfeatures/</a>
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2015-11-13 金 20:59]</span></span>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-16" class="outline-4">
<h4 id="sec-2-1-16">Rubyを勉強する上で有用な情報源まとめてみた - Qiita</h4>
<div class="outline-text-4" id="text-2-1-16">
<p>
<a href="http://qiita.com/taiyop/items/0212a54591e078ae15b6">http://qiita.com/taiyop/items/0212a54591e078ae15b6</a>
<span class="timestamp-wrapper"><span class="timestamp">[2015-11-13 金 02:17]</span></span>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-17" class="outline-4">
<h4 id="sec-2-1-17">ob-ruby</h4>
<div class="outline-text-4" id="text-2-1-17">
<p>
:session name
を指定すると*nameバッファで inf-ruby が動く
実行はしているが，プロンプトの定義がおかしいためか，結果が取れてい
ない。
</p>

<p>
pry をやめるとうまく動く
</p>
</div>
</div>

<div id="outline-container-sec-2-1-18" class="outline-4">
<h4 id="sec-2-1-18">若手エンジニア／初心者のためのRuby 2.1入門（12）：難しいが強力！ Rubyのメタプログラミング、self、特異クラス／メソッド、オープンクラスとモンキーパッチ (1/4) - ＠IT</h4>
<div class="outline-text-4" id="text-2-1-18">
<p>
<a href="http://www.atmarkit.co.jp/ait/articles/1501/06/news028.html">http://www.atmarkit.co.jp/ait/articles/1501/06/news028.html</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-19" class="outline-4">
<h4 id="sec-2-1-19">Ruby - 【mkdirからデプロイまで3分】Sinatra+Haml+Sass+Coffee でサクッとHerokuに公開して捨てるwebアプリ - Qiita</h4>
<div class="outline-text-4" id="text-2-1-19">
<p>
<a href="http://qiita.com/gogotanaka/items/760d4e6ad2b19ff78ff9">http://qiita.com/gogotanaka/items/760d4e6ad2b19ff78ff9</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-20" class="outline-4">
<h4 id="sec-2-1-20">emacs-24.5 for @cis.iwate-u.ac.jp</h4>
</div>

<div id="outline-container-sec-2-1-21" class="outline-4">
<h4 id="sec-2-1-21">~/bin/org2html index.org</h4>
<div class="outline-text-4" id="text-2-1-21">
<p>
Cannot fontify src block (htmlize.el &gt;= 1.34 required)
</p>
<ul class="org-ul">
<li>melpa の htmlize の version は，1.47 なのに
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-2-1-22" class="outline-4">
<h4 id="sec-2-1-22">Todo <a href="http://ditaa.sourceforge.net/">ditaa@github</a> install後，ditaa.jar が見つからない</h4>
<div class="outline-text-4" id="text-2-1-22">
<p>
<a href="lv /opt/local/var/macports/sources/rsync.macports.org/release/ports/java/ditaa/Portfile">lv /opt/local/var/macports/sources/rsync.macports.org/release/ports/java/ditaa/Portfile</a>
</p>
</div>
</div>


<div id="outline-container-sec-2-1-23" class="outline-4">
<h4 id="sec-2-1-23">log new_file  <a href="file:///users/home/masayuki/COMM/working/org-graphvix.html">graphviz</a></h4>
<div class="outline-text-4" id="text-2-1-23">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2015-10-09 金 15:54]</span></span>
</p>
</div>
</div>


<div id="outline-container-sec-2-1-24" class="outline-4">
<h4 id="sec-2-1-24">Emacs org-modeを使ってみる: (19) graphvizとditaaの図を埋め込む - 屯遁のパズルとプログラミングの日記</h4>
<div class="outline-text-4" id="text-2-1-24">
<p>
<a href="http://d.hatena.ne.jp/tamura70/20100222/org">http://d.hatena.ne.jp/tamura70/20100222/org</a>
</p>

<p>
org-modeでGraphviz(dot)を使う
<a href="http://misohena.jp/article/emacs_org_textfigures/dot.html">http://misohena.jp/article/emacs_org_textfigures/dot.html</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-1-25" class="outline-4">
<h4 id="sec-2-1-25">memo lstree&#xa0;&#xa0;&#xa0;<span class="tag"><span class="directory">directory</span></span></h4>
<div class="outline-text-4" id="text-2-1-25">
<p>
<a href="file:///users/home/masayuki/COMM/Prog/ruby/lstree/lstree.rb">file:///users/home/masayuki/COMM/Prog/ruby/lstree/lstree.rb</a>
</p>
</div>
</div>


<div id="outline-container-sec-2-1-26" class="outline-4">
<h4 id="sec-2-1-26">org2HTMLの自動化</h4>
<div class="outline-text-4" id="text-2-1-26">
<p>
~/COMM/bin/org2html
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: suzuki@cis.iwate-u.ac.jp</p>
<p class="date">Created: 2016-10-11 火 21:11</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
