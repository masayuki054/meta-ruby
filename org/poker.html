<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
<title>メタプログラミング Ruby poker</title>
<!-- 2016-12-11 日 21:42 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="suzuki@cis.iwate-u.ac.jp" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">メタプログラミング Ruby poker</h1>
<div id="table-of-contents">
<h2>&#30446;&#27425;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. pokerのテスト駆動開発</a>
<ul>
<li><a href="#sec-1-1">1.1. 目的</a></li>
<li><a href="#sec-1-2">1.2. ポーカーゲーム開発ストーリー</a></li>
<li><a href="#sec-1-3">1.3. テスト駆動開発については</a></li>
<li><a href="#sec-1-4">1.4. test-unit</a></li>
</ul>
</li>
<li><a href="#sec-2">2. 開発概要</a>
<ul>
<li><a href="#sec-2-1">2.1. クラスの構造</a></li>
<li><a href="#sec-2-2">2.2. ディレクトリ構造</a></li>
</ul>
</li>
<li><a href="#sec-3">3. 文芸的プログラムによる開発</a></li>
<li><a href="#sec-4">4. Constant</a>
<ul>
<li><a href="#sec-4-1">4.1. constant</a>
<ul>
<li><a href="#sec-4-1-1">4.1.1. test-constant.rb</a>
<ul>
<li><a href="#sec-4-1-1-1">test の構造</a>
<ul>
<li><a href="#sec-4-1-1-1-1">suit に関するテスト</a></li>
<li><a href="#sec-4-1-1-1-2">no に関するテスト</a></li>
<li><a href="#sec-4-1-1-1-3">カードの枚数に関するテスト</a></li>
<li><a href="#sec-4-1-1-1-4">テスト全体</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4-1-2">4.1.2. constant.rb</a>
<ul>
<li><a href="#sec-4-1-2-1">モジュールの構造</a></li>
<li><a href="#sec-4-1-2-2">suit に関する定数</a></li>
<li><a href="#sec-4-1-2-3">no に関する定数</a></li>
<li><a href="#sec-4-1-2-4">card に関する定数</a></li>
<li><a href="#sec-4-1-2-5">constant.rb</a></li>
</ul>
</li>
<li><a href="#sec-4-1-3">4.1.3. run</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. Card</a>
<ul>
<li><a href="#sec-5-1">5.1. card module</a>
<ul>
<li><a href="#sec-5-1-1">5.1.1. test/test-card.rb</a>
<ul>
<li><a href="#sec-5-1-1-1">構造</a></li>
<li><a href="#sec-5-1-1-2">test/setup</a></li>
<li><a href="#sec-5-1-1-3">test_new</a></li>
<li><a href="#sec-5-1-1-4">test_compare</a></li>
<li><a href="#sec-5-1-1-5">test_to_s</a></li>
<li><a href="#sec-5-1-1-6">test/test-card.rb</a></li>
</ul>
</li>
<li><a href="#sec-5-1-2">5.1.2. card.rb</a>
<ul>
<li><a href="#sec-5-1-2-1">構造</a></li>
<li><a href="#sec-5-1-2-2">new, suit, no</a></li>
<li><a href="#sec-5-1-2-3">compare</a></li>
<li><a href="#sec-5-1-2-4">to_s</a></li>
<li><a href="#sec-5-1-2-5">card.rb</a></li>
</ul>
</li>
<li><a href="#sec-5-1-3">5.1.3. test の実行</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-6">6. Deck</a>
<ul>
<li><a href="#sec-6-1">6.1. deck</a>
<ul>
<li><a href="#sec-6-1-1">6.1.1. test-deck.rb</a>
<ul>
<li><a href="#sec-6-1-1-1">deck test プログラムの構造</a></li>
<li><a href="#sec-6-1-1-2">newのテスト</a></li>
<li><a href="#sec-6-1-1-3">drawのテスト</a></li>
<li><a href="#sec-6-1-1-4">discardのテスト</a></li>
<li><a href="#sec-6-1-1-5">test全体</a></li>
</ul>
</li>
<li><a href="#sec-6-1-2">6.1.2. deck.rb</a>
<ul>
<li><a href="#sec-6-1-2-1">deck class の構造</a></li>
<li><a href="#sec-6-1-2-2">initialize</a></li>
<li><a href="#sec-6-1-2-3">draw</a></li>
<li><a href="#sec-6-1-2-4">size</a></li>
<li><a href="#sec-6-1-2-5">discard</a></li>
<li><a href="#sec-6-1-2-6">shuffle!</a></li>
<li><a href="#sec-6-1-2-7">deck 全体</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-7">7. Hand</a>
<ul>
<li><a href="#sec-7-1">7.1. hand</a>
<ul>
<li><a href="#sec-7-1-1">7.1.1. test-hand.rb</a>
<ul>
<li><a href="#sec-7-1-1-1">setup</a></li>
<li><a href="#sec-7-1-1-2">test method</a></li>
</ul>
</li>
<li><a href="#sec-7-1-2">7.1.2. hand.rb</a>
<ul>
<li><a href="#sec-7-1-2-1">hand class の構造</a></li>
<li><a href="#sec-7-1-2-2">initialize</a></li>
<li><a href="#sec-7-1-2-3">putin 手札にカードを入れる</a></li>
<li><a href="#sec-7-1-2-4">rank 役の強さ</a></li>
<li><a href="#sec-7-1-2-5">judge 役の判定</a>
<ul>
<li><a href="#sec-7-1-2-5-1">calc_pairs ペアの計算</a></li>
<li><a href="#sec-7-1-2-5-2">straight?</a></li>
<li><a href="#sec-7-1-2-5-3">flush?</a></li>
<li><a href="#sec-7-1-2-5-4">hand.rb 全体</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-8">8. Player</a>
<ul>
<li><a href="#sec-8-1">8.1. test-player.rb</a>
<ul>
<li><a href="#sec-8-1-1">8.1.1. test構造</a></li>
<li><a href="#sec-8-1-2">8.1.2. new</a></li>
<li><a href="#sec-8-1-3">8.1.3. test全体</a></li>
</ul>
</li>
<li><a href="#sec-8-2">8.2. player.rb</a>
<ul>
<li><a href="#sec-8-2-1">8.2.1. クラス構造</a></li>
<li><a href="#sec-8-2-2">8.2.2. initialize</a></li>
<li><a href="#sec-8-2-3">8.2.3. player.rb 全体</a>
<ul>
<li><a href="#sec-8-2-3-1">Poker</a>
<ul>
<li><a href="#sec-8-2-3-1-1">poker.rb</a></li>
<li><a href="#sec-8-2-3-1-2">run</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-9">9. Rakefile</a>
<ul>
<li><a href="#sec-9-1">9.1. test 用の Rakefile</a>
<ul>
<li><a href="#sec-9-1-1">9.1.1. rake</a></li>
<li><a href="#sec-9-1-2">9.1.2. Rakefile</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-10">10. emacs/org-mode/ruby のこと</a>
<ul>
<li><a href="#sec-10-1">10.1. org-mode</a>
<ul>
<li><a href="#sec-10-1-1">10.1.1. ソースコードをファイルへ書き出す</a></li>
<li><a href="#sec-10-1-2">10.1.2. ob-shell</a>
<ul>
<li><a href="#sec-10-1-2-1">ob-sh.el ソースコード</a>
<ul>
<li><a href="#sec-10-1-2-1-1">sh の shell 指定</a></li>
<li><a href="#sec-10-1-2-1-2">sh-ブロックの ruby が ~/.rbenv/shims/ruby ではない時</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/index.html">メタプログラミングRuby</a> /
 <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/lects/">毎回 の講義</a> /
 <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/org-docs/oo.html">OO へ至る道</a> /
 <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/org-docs/ruby_begin.html">ruby 入門</a> /
 <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/org-docs/">講義ドキュメント</a> /
 <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/org-docs/meta-ruby">meta-ruby まとめ</a> /
 <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/lects/note/">note</a> /
 <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/lects/note/ruby-note.html">ruby-note</a> /
 <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/lects/poker/">poker</a> 
</p>
<p>
~suzuki/lects/meta-ruby/lects/poker
~suzuki/lects/meta-ruby/lects/note
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> pokerのテスト駆動開発</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 目的</h3>
<div class="outline-text-3" id="text-1-1">
<p>
ソフトウェア構成論で作ったポーカーを，
rubyで作り直し，ruby での開発を体験してみましょう。
</p>

<p>
テスト駆動開発っぽくやってみましょう。
</p>

<p>
emacs org-mode でやりましょう。
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> ポーカーゲーム開発ストーリー</h3>
<div class="outline-text-3" id="text-1-2">
<p>
モジュール分けやモジュールの機能については，<a href="http://wiki.cis.iwate-u.ac.jp/~wiki/prog.cgi?%E8%AC%9B%E7%BE%A9%E5%86%85%E5%AE%B9">Prog Wikky - 講義内容</a>
を参考にしてください。
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> テスト駆動開発については</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/org-docs/what-is-tdd/">ソフトウェア構成論 テスト駆動開発とは</a> を参考にしてください
</p>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> test-unit</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li><a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/lects/note/ruby-note.html">rubyノート</a> ((<a href="file:///users/home/masayuki/meta-ruby.git/org/~suzuki/lects/meta-ruby/lects/note/ruby-note.html">@cis.org</a> <a href="file:///users/home/masayuki/COMM/Lects/meta-ruby/site/lects/note/ruby-note.html">@s.org</a>))
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 開発概要</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> クラスの構造</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-ruby">module Poker

  module Constant

  end
  class Card

  end
  class Deck

  end
  class Hand

  end
  class Player

  end
  class Play

  end
end
</pre>
</div>

<ul class="org-ul">
<li>12/21 Poker::Constant カードに関する定数をまとめるモジュール
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> ディレクトリ構造</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">

<pre class="src src-sh">~/COMM/bin/lstree ../poker
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 文芸的プログラムによる開発</h2>
<div class="outline-text-2" id="text-3">
<p>
例えばcardモジュールは，poker/card.org に作成し，org-babel
の :tangle でtest/の下にテストを，src/の下にクラスを，作りましょう。
</p>

<p>
~suzuki/lects/meta-ruby/lects/poker の下にこのドキュメントがあります。
参考にしてください。
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Constant</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> constant</h3>
<div class="outline-text-3" id="text-4-1">
<p>
カードに関する定数を定義するモジュール
</p>
</div>

<div id="outline-container-sec-4-1-1" class="outline-4">
<h4 id="sec-4-1-1"><span class="section-number-4">4.1.1</span> test-constant.rb</h4>
<div class="outline-text-4" id="text-4-1-1">
</div><div id="outline-container-sec-4-1-1-1" class="outline-5">
<h5 id="sec-4-1-1-1">test の構造</h5>
<div class="outline-text-5" id="text-4-1-1-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'constant'

class Test_Constant &lt; Test::Unit::TestCase
  include Poker
</pre>
</div>
<div class="org-src-container">

<pre class="src src-ruby">end
</pre>
</div>
</div>

<div id="outline-container-sec-4-1-1-1-1" class="outline-6">
<h6 id="sec-4-1-1-1-1">suit に関するテスト</h6>
<div class="outline-text-6" id="text-4-1-1-1-1">
<div class="org-src-container">

<pre class="src src-ruby">def test_constant_suit
  assert_equal(Const::SuitSyms.index(:CLUB), Const::CLUB)
  assert_equal(Const::SuitSyms.index(:DIAMOND), Const::DIAMOND)
  assert_equal(Const::SuitSyms.index(:HEART), Const::HEART)
  assert_equal(Const::SuitSyms.index(:SPADE), Const::SPADE)
  assert_equal(Const::SuitOrder[0], Const::CLUB)
  assert_equal(Const::SuitOrder[1], Const::DIAMOND)
  assert_equal(Const::SuitOrder[2], Const::HEART)
  assert_equal(Const::SuitOrder[3], Const::SPADE)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-1-1-2" class="outline-6">
<h6 id="sec-4-1-1-1-2">no に関するテスト</h6>
<div class="outline-text-6" id="text-4-1-1-1-2">
<div class="org-src-container">

<pre class="src src-ruby">def test_constant_no
  assert_equal(Const::NoOrder, [  
		 Const::TWO, Const::THREE, Const::FOUR, Const::FIVE,
		 Const::SIX, Const::SEVEN, Const::EIGHT, Const::NINE,
		 Const::TEN, Const::JACK, Const::QUEEN, Const::KING,
		 Const::ACE])
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-1-1-3" class="outline-6">
<h6 id="sec-4-1-1-1-3">カードの枚数に関するテスト</h6>
<div class="outline-text-6" id="text-4-1-1-1-3">
<div class="org-src-container">

<pre class="src src-ruby">def test_constant_card
  assert_equal(52, Const::No_of_Cards)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-1-1-4" class="outline-6">
<h6 id="sec-4-1-1-1-4">テスト全体</h6>
<div class="outline-text-6" id="text-4-1-1-1-4">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'constant'

class Test_Constant &lt; Test::Unit::TestCase
  include Poker

def test_constant_suit
  assert_equal(Const::SuitSyms.index(:CLUB), Const::CLUB)
  assert_equal(Const::SuitSyms.index(:DIAMOND), Const::DIAMOND)
  assert_equal(Const::SuitSyms.index(:HEART), Const::HEART)
  assert_equal(Const::SuitSyms.index(:SPADE), Const::SPADE)
  assert_equal(Const::SuitOrder[0], Const::CLUB)
  assert_equal(Const::SuitOrder[1], Const::DIAMOND)
  assert_equal(Const::SuitOrder[2], Const::HEART)
  assert_equal(Const::SuitOrder[3], Const::SPADE)
end

def test_constant_no
  assert_equal(Const::NoOrder, [  
		 Const::TWO, Const::THREE, Const::FOUR, Const::FIVE,
		 Const::SIX, Const::SEVEN, Const::EIGHT, Const::NINE,
		 Const::TEN, Const::JACK, Const::QUEEN, Const::KING,
		 Const::ACE])
end

def test_constant_card
  assert_equal(52, Const::No_of_Cards)
end

end
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-4-1-2" class="outline-4">
<h4 id="sec-4-1-2"><span class="section-number-4">4.1.2</span> constant.rb</h4>
<div class="outline-text-4" id="text-4-1-2">
</div><div id="outline-container-sec-4-1-2-1" class="outline-5">
<h5 id="sec-4-1-2-1">モジュールの構造</h5>
<div class="outline-text-5" id="text-4-1-2-1">
<div class="org-src-container">

<pre class="src src-ruby">module Poker

  module Const
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">  end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-2-2" class="outline-5">
<h5 id="sec-4-1-2-2">suit に関する定数</h5>
<div class="outline-text-5" id="text-4-1-2-2">
<div class="org-src-container">

<pre class="src src-ruby">SuitSyms = [:CLUB, :DIAMOND, :HEART, :SPADE] 
SuitChars = ['C', 'D', 'H', 'S'] 
SuitOrder = [] # suit の強さ

# 定数の生成: CLUB， DIAMOND, HEART, SPADE 

SuitSyms.each_index do |i| 
  SuitOrder &lt;&lt; const_set(SuitSyms[i], i)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-2-3" class="outline-5">
<h5 id="sec-4-1-2-3">no に関する定数</h5>
<div class="outline-text-5" id="text-4-1-2-3">
<div class="org-src-container">

<pre class="src src-ruby">NoSyms = [:TWO, :THREE, :FOUR, :FIVE, :SIX, :SEVEN, :EIGHT, :NINE, :TEN,
	  :JACK, :QUEEN, :KING, :ACE]
NoChars = ['2', '3', '4', '5', '6', '7', '8', '9', '0', 'J', 'Q', 'K', 'A']
NoOrder = []
NoSyms.each_index do |i| 
  NoOrder &lt;&lt; const_set(NoSyms[i], i)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-2-4" class="outline-5">
<h5 id="sec-4-1-2-4">card に関する定数</h5>
<div class="outline-text-5" id="text-4-1-2-4">
<div class="org-src-container">

<pre class="src src-ruby">No_of_Cards = SuitOrder.size*NoOrder.size
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-2-5" class="outline-5">
<h5 id="sec-4-1-2-5">constant.rb</h5>
<div class="outline-text-5" id="text-4-1-2-5">
<div class="org-src-container">

<pre class="src src-ruby">module Poker

  module Const

SuitSyms = [:CLUB, :DIAMOND, :HEART, :SPADE] 
SuitChars = ['C', 'D', 'H', 'S'] 
SuitOrder = [] # suit の強さ

# 定数の生成: CLUB， DIAMOND, HEART, SPADE 

SuitSyms.each_index do |i| 
  SuitOrder &lt;&lt; const_set(SuitSyms[i], i)
end


NoSyms = [:TWO, :THREE, :FOUR, :FIVE, :SIX, :SEVEN, :EIGHT, :NINE, :TEN,
	  :JACK, :QUEEN, :KING, :ACE]
NoChars = ['2', '3', '4', '5', '6', '7', '8', '9', '0', 'J', 'Q', 'K', 'A']
NoOrder = []
NoSyms.each_index do |i| 
  NoOrder &lt;&lt; const_set(NoSyms[i], i)
end

No_of_Cards = SuitOrder.size*NoOrder.size


  end
end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-3" class="outline-4">
<h4 id="sec-4-1-3"><span class="section-number-4">4.1.3</span> run</h4>
<div class="outline-text-4" id="text-4-1-3">
<div class="org-src-container">

<pre class="src src-sh">ruby -I./src test/test-constant.rb
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Card</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> card module</h3>
<div class="outline-text-3" id="text-5-1">
</div><div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><span class="section-number-4">5.1.1</span> test/test-card.rb</h4>
<div class="outline-text-4" id="text-5-1-1">
</div><div id="outline-container-sec-5-1-1-1" class="outline-5">
<h5 id="sec-5-1-1-1">構造</h5>
<div class="outline-text-5" id="text-5-1-1-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'constant'
require 'card'

class Test_Card &lt; Test::Unit::TestCase
  include Poker
</pre>
</div>
<div class="org-src-container">

<pre class="src src-ruby">end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-1-2" class="outline-5">
<h5 id="sec-5-1-1-2">test/setup</h5>
<div class="outline-text-5" id="text-5-1-1-2">
<div class="org-src-container">

<pre class="src src-ruby">def setup
  @sa = Card.new(Const::SPADE, Const::ACE)
  @sk = Card.new(Const::SPADE, Const::KING)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-1-3" class="outline-5">
<h5 id="sec-5-1-1-3">test_new</h5>
<div class="outline-text-5" id="text-5-1-1-3">
<div class="org-src-container">

<pre class="src src-ruby">def test_card_new
  assert_equal(Card, @sa.class)
  assert_equal(Const::SPADE, @sa.suit)
  assert_equal(Const::ACE, @sa.no)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-1-4" class="outline-5">
<h5 id="sec-5-1-1-4">test_compare</h5>
<div class="outline-text-5" id="text-5-1-1-4">
<div class="org-src-container">

<pre class="src src-ruby">def test_card_compare
  assert_equal(1, @sa.compare(@sk))
  assert_equal(0, @sa.compare(@sa))
  assert_equal(-1, @sk.compare(@sa))
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-1-5" class="outline-5">
<h5 id="sec-5-1-1-5">test_to_s</h5>
<div class="outline-text-5" id="text-5-1-1-5">
<div class="org-src-container">

<pre class="src src-ruby">def test_card_to_s
  assert_equal('SK', @sk.to_s)
  assert_equal('SA', @sa.to_s)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-1-6" class="outline-5">
<h5 id="sec-5-1-1-6">test/test-card.rb</h5>
<div class="outline-text-5" id="text-5-1-1-6">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'constant'
require 'card'

class Test_Card &lt; Test::Unit::TestCase
  include Poker

def setup
  @sa = Card.new(Const::SPADE, Const::ACE)
  @sk = Card.new(Const::SPADE, Const::KING)
end

def test_card_new
  assert_equal(Card, @sa.class)
  assert_equal(Const::SPADE, @sa.suit)
  assert_equal(Const::ACE, @sa.no)
end

def test_card_compare
  assert_equal(1, @sa.compare(@sk))
  assert_equal(0, @sa.compare(@sa))
  assert_equal(-1, @sk.compare(@sa))
end

def test_card_to_s
  assert_equal('SK', @sk.to_s)
  assert_equal('SA', @sa.to_s)
end

end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-2" class="outline-4">
<h4 id="sec-5-1-2"><span class="section-number-4">5.1.2</span> card.rb</h4>
<div class="outline-text-4" id="text-5-1-2">
</div><div id="outline-container-sec-5-1-2-1" class="outline-5">
<h5 id="sec-5-1-2-1">構造</h5>
<div class="outline-text-5" id="text-5-1-2-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'constant'

module Poker

  class Card
</pre>
</div>
<div class="org-src-container">

<pre class="src src-ruby">  end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-2-2" class="outline-5">
<h5 id="sec-5-1-2-2">new, suit, no</h5>
<div class="outline-text-5" id="text-5-1-2-2">
<div class="org-src-container">

<pre class="src src-ruby">attr_reader :suit, :no

def initialize(suit, no)
  no = 14 if no==1
  @suit = suit
  @no = no
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-2-3" class="outline-5">
<h5 id="sec-5-1-2-3">compare</h5>
<div class="outline-text-5" id="text-5-1-2-3">
<div class="org-src-container">

<pre class="src src-ruby">def &lt;=&gt; (another)
  return 1 if @no &gt; another.no
  return -1 if @no &lt; another.no
  return 1 if @suit &gt; another.suit
  return -1 if @suit &lt; another.suit
  return 0
end

alias :compare :&lt;=&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-2-4" class="outline-5">
<h5 id="sec-5-1-2-4">to_s</h5>
<div class="outline-text-5" id="text-5-1-2-4">
<div class="org-src-container">

<pre class="src src-ruby">def to_s
  (Const::SuitChars[@suit])+(Const::NoChars[@no])
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-2-5" class="outline-5">
<h5 id="sec-5-1-2-5">card.rb</h5>
<div class="outline-text-5" id="text-5-1-2-5">
<div class="org-src-container">

<pre class="src src-ruby" id="card.rb">require 'constant'

module Poker

  class Card 

attr_reader :suit, :no

def initialize(suit, no)
  no = 14 if no==1
  @suit = suit
  @no = no
end

def &lt;=&gt; (another)
  return 1 if @no &gt; another.no
  return -1 if @no &lt; another.no
  return 1 if @suit &gt; another.suit
  return -1 if @suit &lt; another.suit
  return 0
end

alias :compare :&lt;=&gt;

def to_s
  (Const::SuitChars[@suit])+(Const::NoChars[@no])
end

  end
end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-3" class="outline-4">
<h4 id="sec-5-1-3"><span class="section-number-4">5.1.3</span> test の実行</h4>
<div class="outline-text-4" id="text-5-1-3">
<div class="org-src-container">

<pre class="src src-sh"># ~/.rbenv/shims/ruby -I./src/ test/test_card.rb
ruby -I./src/ test/test_card.rb
echo 'end'
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Deck</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> deck</h3>
<div class="outline-text-3" id="text-6-1">
</div><div id="outline-container-sec-6-1-1" class="outline-4">
<h4 id="sec-6-1-1"><span class="section-number-4">6.1.1</span> test-deck.rb</h4>
<div class="outline-text-4" id="text-6-1-1">
</div><div id="outline-container-sec-6-1-1-1" class="outline-5">
<h5 id="sec-6-1-1-1">deck test プログラムの構造</h5>
<div class="outline-text-5" id="text-6-1-1-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'constant'
require 'card'
require 'deck'

class TestDeck &lt; Test::Unit::TestCase
  include Poker
</pre>
</div>
<div class="org-src-container">

<pre class="src src-ruby">end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-1-2" class="outline-5">
<h5 id="sec-6-1-1-2">newのテスト</h5>
<div class="outline-text-5" id="text-6-1-1-2">
<div class="org-src-container">

<pre class="src src-ruby">def test_deck_new
  @d = Deck.new
  assert_equal(Const::No_of_Cards, @d.size)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-1-3" class="outline-5">
<h5 id="sec-6-1-1-3">drawのテスト</h5>
<div class="outline-text-5" id="text-6-1-1-3">
<div class="org-src-container">

<pre class="src src-ruby">def test_deck_draw
  @d = Deck.new
  size = @d.size
  c = @d.draw
  assert_equal(Card, c.class)
  assert_equal(1, size-@d.size)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-1-4" class="outline-5">
<h5 id="sec-6-1-1-4">discardのテスト</h5>
<div class="outline-text-5" id="text-6-1-1-4">
<div class="org-src-container">

<pre class="src src-ruby">def test_deck_discard
  @d = Deck.new
  (2*Const::No_of_Cards).times do |i|
    c = @d.draw
    assert_equal(Card, c.class)
    @d.discard(c)
  end
  assert_equal(0, @d.size)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-1-5" class="outline-5">
<h5 id="sec-6-1-1-5">test全体</h5>
<div class="outline-text-5" id="text-6-1-1-5">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'constant'
require 'card'
require 'deck'

class TestDeck &lt; Test::Unit::TestCase
  include Poker

def test_deck_new
  @d = Deck.new
  assert_equal(Const::No_of_Cards, @d.size)
end

def test_deck_draw
  @d = Deck.new
  size = @d.size
  c = @d.draw
  assert_equal(Card, c.class)
  assert_equal(1, size-@d.size)
end

def test_deck_discard
  @d = Deck.new
  (2*Const::No_of_Cards).times do |i|
    c = @d.draw
    assert_equal(Card, c.class)
    @d.discard(c)
  end
  assert_equal(0, @d.size)
end
end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-2" class="outline-4">
<h4 id="sec-6-1-2"><span class="section-number-4">6.1.2</span> deck.rb</h4>
<div class="outline-text-4" id="text-6-1-2">
</div><div id="outline-container-sec-6-1-2-1" class="outline-5">
<h5 id="sec-6-1-2-1">deck class の構造</h5>
<div class="outline-text-5" id="text-6-1-2-1">
<div class="org-src-container">

<pre class="src src-ruby"># deck.rb
module Poker
  class Deck
</pre>
</div>
<div class="org-src-container">

<pre class="src src-ruby">  end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-2-2" class="outline-5">
<h5 id="sec-6-1-2-2">initialize</h5>
<div class="outline-text-5" id="text-6-1-2-2">
<div class="org-src-container">

<pre class="src src-ruby">def initialize

  @stock = []
  @used = []

  Const::SuitOrder.each { |suit|
    Const::NoOrder.each { |no|
      @stock.push(Card.new(suit, no))
    }
  }
  @stock.shuffle!

end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-2-3" class="outline-5">
<h5 id="sec-6-1-2-3">draw</h5>
<div class="outline-text-5" id="text-6-1-2-3">
<div class="org-src-container">

<pre class="src src-ruby">def draw
  if @stock.size == 0
    @stock = @used
    @used = []
    @stock.shuffle!
  end
  @stock.pop
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-2-4" class="outline-5">
<h5 id="sec-6-1-2-4">size</h5>
<div class="outline-text-5" id="text-6-1-2-4">
<div class="org-src-container">

<pre class="src src-ruby">def size
  @stock.size
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-2-5" class="outline-5">
<h5 id="sec-6-1-2-5">discard</h5>
<div class="outline-text-5" id="text-6-1-2-5">
<div class="org-src-container">

<pre class="src src-ruby">def discard(card)
  @used.push(card)
  self
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-2-6" class="outline-5">
<h5 id="sec-6-1-2-6">shuffle!</h5>
<div class="outline-text-5" id="text-6-1-2-6">
<div class="org-src-container">

<pre class="src src-ruby">def shuffle!
  @stock.shuffle!
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-1-2-7" class="outline-5">
<h5 id="sec-6-1-2-7">deck 全体</h5>
<div class="outline-text-5" id="text-6-1-2-7">
<div class="org-src-container">

<pre class="src src-ruby"># deck.rb
module Poker
  class Deck

def initialize

  @stock = []
  @used = []

  Const::SuitOrder.each { |suit|
    Const::NoOrder.each { |no|
      @stock.push(Card.new(suit, no))
    }
  }
  @stock.shuffle!

end

def draw
  if @stock.size == 0
    @stock = @used
    @used = []
    @stock.shuffle!
  end
  @stock.pop
end


def discard(card)
  @used.push(card)
  self
end


def size
  @stock.size
end


def shuffle!
  @stock.shuffle!
end

  end
end
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Hand</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> hand</h3>
<div class="outline-text-3" id="text-7-1">
</div><div id="outline-container-sec-7-1-1" class="outline-4">
<h4 id="sec-7-1-1"><span class="section-number-4">7.1.1</span> test-hand.rb</h4>
<div class="outline-text-4" id="text-7-1-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'card'
require 'hand'

include Poker

class Test_Hand &lt; Test::Unit::TestCase
</pre>
</div>
<div class="org-src-container">

<pre class="src src-ruby">end
</pre>
</div>
</div>

<div id="outline-container-sec-7-1-1-1" class="outline-5">
<h5 id="sec-7-1-1-1">setup</h5>
<div class="outline-text-5" id="text-7-1-1-1">
<div class="org-src-container">

<pre class="src src-ruby">def setup
  @ha = Card.new(Const::HEART, Const::ACE)
  @sa = Card.new(Const::SPADE, Const::ACE)
  @ca = Card.new(Const::CLUB, Const::ACE)
  @sq = Card.new(Const::SPADE, Const::QUEEN)
  @hq = Card.new(Const::HEART, Const::QUEEN)
  @hand = Hand.new
  @hand.putin(@ha)
  @hand.putin(@sa)
  @hand.putin(@ca)
  @hand.putin(@sq)
  @hand.putin(@hq)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-1-2" class="outline-5">
<h5 id="sec-7-1-1-2">test method</h5>
<div class="outline-text-5" id="text-7-1-1-2">
<div class="org-src-container">

<pre class="src src-ruby">def test_fullhouse
  assert_equal(:fullHouse, @hand.judge)
end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'card'
require 'hand'

include Poker

class Test_Hand &lt; Test::Unit::TestCase
def setup
  @ha = Card.new(Const::HEART, Const::ACE)
  @sa = Card.new(Const::SPADE, Const::ACE)
  @ca = Card.new(Const::CLUB, Const::ACE)
  @sq = Card.new(Const::SPADE, Const::QUEEN)
  @hq = Card.new(Const::HEART, Const::QUEEN)
  @hand = Hand.new
  @hand.putin(@ha)
  @hand.putin(@sa)
  @hand.putin(@ca)
  @hand.putin(@sq)
  @hand.putin(@hq)
end

def test_fullhouse
  assert_equal(:fullHouse, @hand.judge)
end
end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-2" class="outline-4">
<h4 id="sec-7-1-2"><span class="section-number-4">7.1.2</span> hand.rb</h4>
<div class="outline-text-4" id="text-7-1-2">
</div><div id="outline-container-sec-7-1-2-1" class="outline-5">
<h5 id="sec-7-1-2-1">hand class の構造</h5>
<div class="outline-text-5" id="text-7-1-2-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'card'

module Poker

  class Hand

    PokerHands = [
      :highCard, :onePair, :twoPairs, 
      :threeCards, :straight, :flush, :fullHouse, :fourCards, :straightFlush
    ]
</pre>
</div>
<div class="org-src-container">

<pre class="src src-ruby">  end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-2-2" class="outline-5">
<h5 id="sec-7-1-2-2">initialize</h5>
<div class="outline-text-5" id="text-7-1-2-2">
<div class="org-src-container">

<pre class="src src-ruby">attr_reader :hand

def initialize
  @hand = []
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-2-3" class="outline-5">
<h5 id="sec-7-1-2-3">putin 手札にカードを入れる</h5>
<div class="outline-text-5" id="text-7-1-2-3">
<div class="org-src-container">

<pre class="src src-ruby">def putin(card)
  @hand.push(card).sort!
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-2-4" class="outline-5">
<h5 id="sec-7-1-2-4">rank 役の強さ</h5>
<div class="outline-text-5" id="text-7-1-2-4">
<div class="org-src-container">

<pre class="src src-ruby">def rank
  PokerHands.index(judge)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-2-5" class="outline-5">
<h5 id="sec-7-1-2-5">judge 役の判定</h5>
<div class="outline-text-5" id="text-7-1-2-5">
<div class="org-src-container">

<pre class="src src-ruby">def judge
  s = straight?
  f = flush?
  return :straightFlush if s &amp;&amp; f 
  return :straight if s 
  return :flush if f 
  return calc_pairs
end
</pre>
</div>
</div>

<div id="outline-container-sec-7-1-2-5-1" class="outline-6">
<h6 id="sec-7-1-2-5-1">calc_pairs ペアの計算</h6>
<div class="outline-text-6" id="text-7-1-2-5-1">
<div class="org-src-container">

<pre class="src src-ruby">def calc_pairs
  p = 0
  @hand.each { |a|
    @hand.each { |b|
      p = p+1 if a.no == b.no
    }
  }
  case p 
  when 5 then :highCard 
  when 7 then :onePair 
  when 9 then :twoPairs
  when 11 then :threeCards
  when 13 then :fullHouse 
  when 17 then :fourCards 
  end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-2-5-2" class="outline-6">
<h6 id="sec-7-1-2-5-2">straight?</h6>
<div class="outline-text-6" id="text-7-1-2-5-2">
<div class="org-src-container">

<pre class="src src-ruby">def straight?
  false
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-2-5-3" class="outline-6">
<h6 id="sec-7-1-2-5-3">flush?</h6>
<div class="outline-text-6" id="text-7-1-2-5-3">
<div class="org-src-container">

<pre class="src src-ruby">def flush?
  false
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-2-5-4" class="outline-6">
<h6 id="sec-7-1-2-5-4">hand.rb 全体</h6>
<div class="outline-text-6" id="text-7-1-2-5-4">
<div class="org-src-container">

<pre class="src src-ruby">require 'card'

module Poker

  class Hand

    PokerHands = [
      :highCard, :onePair, :twoPairs, 
      :threeCards, :straight, :flush, :fullHouse, :fourCards, :straightFlush
    ]

attr_reader :hand

def initialize
  @hand = []
end

def putin(card)
  @hand.push(card).sort!
end

def rank
  PokerHands.index(judge)
end

def judge
  s = straight?
  f = flush?
  return :straightFlush if s &amp;&amp; f 
  return :straight if s 
  return :flush if f 
  return calc_pairs
end

def calc_pairs
  p = 0
  @hand.each { |a|
    @hand.each { |b|
      p = p+1 if a.no == b.no
    }
  }
  case p 
  when 5 then :highCard 
  when 7 then :onePair 
  when 9 then :twoPairs
  when 11 then :threeCards
  when 13 then :fullHouse 
  when 17 then :fourCards 
  end
end

def straight?
  false
end

def flush?
  false
end

  end
end
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Player</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> test-player.rb</h3>
<div class="outline-text-3" id="text-8-1">
</div><div id="outline-container-sec-8-1-1" class="outline-4">
<h4 id="sec-8-1-1"><span class="section-number-4">8.1.1</span> test構造</h4>
<div class="outline-text-4" id="text-8-1-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'constant'
require 'card'
require 'hand'
require 'player' 

class TestDeck &lt; Test::Unit::TestCase
  include Poker
</pre>
</div>
<div class="org-src-container">

<pre class="src src-ruby">end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-1-2" class="outline-4">
<h4 id="sec-8-1-2"><span class="section-number-4">8.1.2</span> new</h4>
<div class="outline-text-4" id="text-8-1-2">
<div class="org-src-container">

<pre class="src src-ruby">def test_player_new
  @p = Player.new("hoge")
  assert_equal("hoge",  @p.name)
  assert_equal(Hand.new, @p.hand)
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-1-3" class="outline-4">
<h4 id="sec-8-1-3"><span class="section-number-4">8.1.3</span> test全体</h4>
<div class="outline-text-4" id="text-8-1-3">
<div class="org-src-container">

<pre class="src src-ruby">require 'test/unit'
require 'constant'
require 'card'
require 'hand'
require 'player' 

class TestDeck &lt; Test::Unit::TestCase
  include Poker

def test_player_new
  @p = Player.new("hoge")
  assert_equal("hoge",  @p.name)
  assert_equal(Hand.new, @p.hand)
end

end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> player.rb</h3>
<div class="outline-text-3" id="text-8-2">
</div><div id="outline-container-sec-8-2-1" class="outline-4">
<h4 id="sec-8-2-1"><span class="section-number-4">8.2.1</span> クラス構造</h4>
<div class="outline-text-4" id="text-8-2-1">
<div class="org-src-container">

<pre class="src src-ruby">module Poker

  class Player
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8-2-2" class="outline-4">
<h4 id="sec-8-2-2"><span class="section-number-4">8.2.2</span> initialize</h4>
<div class="outline-text-4" id="text-8-2-2">
<div class="org-src-container">

<pre class="src src-ruby">attr_reader :name, :hand

def initialize(name)
  @name = name
  @hand = Hand.new()
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-2-3" class="outline-4">
<h4 id="sec-8-2-3"><span class="section-number-4">8.2.3</span> player.rb 全体</h4>
<div class="outline-text-4" id="text-8-2-3">
</div>
<div id="outline-container-sec-8-2-3-1" class="outline-5">
<h5 id="sec-8-2-3-1">Poker</h5>
<div class="outline-text-5" id="text-8-2-3-1">
</div><div id="outline-container-sec-8-2-3-1-1" class="outline-6">
<h6 id="sec-8-2-3-1-1">poker.rb</h6>
<div class="outline-text-6" id="text-8-2-3-1-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'card'
require 'deck'
require 'hand'
require 'player'

module Poker

  class Play

    def initialize (names = ["foo", "bar", "hoge", "nanasi", "gombei"])
      @players = names.map { |n| Player.new(n) }      
    end

    def play
      deck = Deck.new
      5.times do 
	@players.each do |p|
	  p.hand.putin(deck.draw)
	end
      end

      @players.each do |p|
	print p.name, ": "
	print p.hand.hand
      end

      @players.each do |p|
	p p.hand.judge
      end
    end
  end
end

if __FILE__ ==$0
  (Poker::Play).new.play
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-2-3-1-2" class="outline-6">
<h6 id="sec-8-2-3-1-2">run</h6>
<div class="outline-text-6" id="text-8-2-3-1-2">
<div class="org-src-container">

<pre class="src src-sh">ruby -I./src poker.rb
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Rakefile</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> test 用の Rakefile</h3>
<div class="outline-text-3" id="text-9-1">
</div><div id="outline-container-sec-9-1-1" class="outline-4">
<h4 id="sec-9-1-1"><span class="section-number-4">9.1.1</span> rake</h4>
<div class="outline-text-4" id="text-9-1-1">
<p>
<a href="http://docs.ruby-lang.org/ja/2.2.0/library/rake.html">library rake (Ruby 2.2.0)</a> はビルドツール
</p>

<p>
Rakefile は，ruby で書ける Makefile
</p>
</div>
</div>

<div id="outline-container-sec-9-1-2" class="outline-4">
<h4 id="sec-9-1-2"><span class="section-number-4">9.1.2</span> Rakefile</h4>
<div class="outline-text-4" id="text-9-1-2">
<div class="org-src-container">

<pre class="src src-ruby"># coding:utf-8
tests = ["test-card.rb", 
	 "test-deck.rb",
	 "test-hand.rb",
	 "test-player.rb",
	]

task :default =&gt; :test

task :test do
  tests.each do |test_file|
    sh "ruby -I./src test/#{test_file}"
  end
end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">rake test
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> emacs/org-mode/ruby のこと</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> org-mode</h3>
<div class="outline-text-3" id="text-10-1">
</div><div id="outline-container-sec-10-1-1" class="outline-4">
<h4 id="sec-10-1-1"><span class="section-number-4">10.1.1</span> ソースコードをファイルへ書き出す</h4>
<div class="outline-text-4" id="text-10-1-1">
<p>
org-mode での書き方
</p>

<pre class="example">
#+BEGIN_SRC ruby :tangle example/test_card.rb :mkdirp yes
# example/test_card.rb
require 'rubygems'
require 'test/unit'
'end'
#+END_SRC
</pre>

<p>
Emacs コマンド
</p>
<pre class="example">
C-C C-v C-t
</pre>

<div class="org-src-container">

<pre class="src src-ruby"># example/test_card.rb
require 'rubygems'
require 'test/unit'
end'
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-10-1-2" class="outline-4">
<h4 id="sec-10-1-2"><span class="section-number-4">10.1.2</span> ob-shell</h4>
<div class="outline-text-4" id="text-10-1-2">
</div><div id="outline-container-sec-10-1-2-1" class="outline-5">
<h5 id="sec-10-1-2-1">ob-sh.el ソースコード</h5>
<div class="outline-text-5" id="text-10-1-2-1">
<p>
<a href="https://github.com/tkf/org-mode/blob/master/lisp/ob-sh.el">org-mode/ob-sh.el at master · tkf/org-mode</a>
</p>
</div>

<div id="outline-container-sec-10-1-2-1-1" class="outline-6">
<h6 id="sec-10-1-2-1-1">sh の shell 指定</h6>
<div class="outline-text-6" id="text-10-1-2-1-1">
<div class="org-src-container">

<pre class="src src-elisp">(defvar org-babel-sh-command "sh"
  "Command used to invoke a shell.
This will be passed to  `shell-command-on-region'")
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-10-1-2-1-2" class="outline-6">
<h6 id="sec-10-1-2-1-2">sh-ブロックの ruby が ~/.rbenv/shims/ruby ではない時</h6>
<div class="outline-text-6" id="text-10-1-2-1-2">
<p>
~/.rbevn/shims/ruby が動かないときは，
sh-ブロックに :session を指定して，
動かして，シェルバッファに移動して，
</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">&#33879;&#32773;: suzuki@cis.iwate-u.ac.jp</p>
<p class="date">Created: 2016-12-11 日 21:42</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.1.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
